---
description: 
globs: 
alwaysApply: false
---
# Neo4j Service Extraction - Railway Template Implementation

## üéØ Overview

Extract Neo4j functionality from `apps/omnii_mcp` into a dedicated `apps/neo4j-service` using the **deployed Railway Neo4j template** to achieve:
- **Separation of Concerns**: Isolate graph database operations
- **Railway Internal Networking**: Use Railway's managed Neo4j instance  
- **Better Maintainability**: Focused codebase for graph operations
- **Fault Isolation**: Neo4j issues won't affect core services

## üö® **CRITICAL**: Environment Variable Correction Needed

### **Current Issue**:
Your environment variables still point to **external AuraDB**:
```bash
NEO4J_URI="bolt+s://d066c29d.databases.neo4j.io:7687"  # ‚ùå EXTERNAL AURADB
NEO4J_PASSWORD="_o0JebFPkSb51lSjC7BUqdsvDhD4e5bYGFV1uoVv3QE"
NEO4J_USER="neo4j"
NEO4J_DATABASE="neo4j"
```

### **Railway Template Variables** (from [template source](mdc:https:/github.com/sukrutnrvd/neo4j-template)):
```bash
DB_PASSWORD="t5aasc8n01smso1liiss5b6clu8z5q97"      # Railway template password
NODE_CSV_URLS=""                                      # Bulk import feature
RELATION_CSV_URLS=""                                  # Bulk import feature
# Plus auto-generated TCP address: neo4j://railway-tcp-address
```

## üîÑ **FIRST STEP**: Switch to Railway Neo4j Template

### **Get Railway Neo4j Connection Details**:

1. **In Railway Dashboard**:
   - Go to your Neo4j template service
   - Navigate to **Service Settings** ‚Üí **Networking** tab
   - Copy the **TCP address** (should be like: `neo4j://xyz.railway.internal:7687`)
   - Note the auto-generated password

2. **Expected Railway Neo4j Variables**:
   ```bash
   NEO4J_URI=neo4j://your-railway-tcp-address.railway.internal:7687  # ‚úÖ RAILWAY INTERNAL
   NEO4J_USER=neo4j
   NEO4J_PASSWORD=t5aasc8n01smso1liiss5b6clu8z5q97                    # ‚úÖ RAILWAY GENERATED
   NEO4J_DATABASE=neo4j
   ```

## üèóÔ∏è **Updated Architecture** - Railway Template Based

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   omnii_mcp     ‚îÇ    ‚îÇ  neo4j-service  ‚îÇ    ‚îÇ Railway Neo4j   ‚îÇ
‚îÇ   (Core API)    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  (Graph API)    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   Template      ‚îÇ
‚îÇ   Port 8000     ‚îÇ    ‚îÇ   Port 8002     ‚îÇ    ‚îÇ   Port 7687     ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ WebSocket     ‚îÇ    ‚îÇ ‚Ä¢ Concepts      ‚îÇ    ‚îÇ ‚Ä¢ Internal TCP  ‚îÇ
‚îÇ ‚Ä¢ SMS/Chat      ‚îÇ    ‚îÇ ‚Ä¢ Search        ‚îÇ    ‚îÇ ‚Ä¢ Auto Password ‚îÇ
‚îÇ ‚Ä¢ RDF Services  ‚îÇ    ‚îÇ ‚Ä¢ Brain Memory  ‚îÇ    ‚îÇ ‚Ä¢ CSV Import    ‚îÇ
‚îÇ ‚Ä¢ Action Plan   ‚îÇ    ‚îÇ ‚Ä¢ Health Check  ‚îÇ    ‚îÇ ‚Ä¢ Logging       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                        ‚îÇ                        ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Railway Internal Network ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìã **UPDATED EXECUTION PLAN**

### **Phase 0: Switch to Railway Neo4j Template** ‚ö†Ô∏è **CRITICAL FIRST**

#### **0.1 Get Railway Neo4j Details**
```bash
# In Railway Dashboard:
# 1. Find your deployed Neo4j template service
# 2. Go to Settings ‚Üí Networking
# 3. Copy the TCP address (neo4j://xxxx.railway.internal:7687)
# 4. Get the DB_PASSWORD from environment variables
```

#### **0.2 Test Railway Neo4j Connection**
```bash
# Test the Railway Neo4j instance first
# Update your current omnii_mcp temporarily to test Railway connection

# In apps/omnii_mcp/.env (LOCAL TESTING):
NEO4J_URI=neo4j://your-railway-tcp-address.railway.internal:7687
NEO4J_USER=neo4j  
NEO4J_PASSWORD=t5aasc8n01smso1liiss5b6clu8z5q97  # From Railway
NEO4J_DATABASE=neo4j

# Test connection:
cd apps/omnii_mcp
npm run dev
# Check logs for successful Railway Neo4j connection
```

### **Phase 1: Create Neo4j Service Structure**

#### **1.1 Create Directory Structure**
```bash
mkdir -p apps/neo4j-service/{src/{config,routes,services,types,utils},tests}
```

#### **1.2 Package Configuration for Railway Template**

**File: `apps/neo4j-service/package.json`**
```json
{
  "name": "@omnii/neo4j-service",
  "version": "1.0.0",
  "description": "Dedicated Neo4j Service using Railway Template",
  "main": "dist/app.js",
  "scripts": {
    "build": "bun build src/app.ts --outdir ./dist --target node",
    "build:prod": "bun build src/app.ts --outdir ./dist --target node --minify",
    "start": "bun run dist/app.js",
    "start:prod": "NODE_ENV=production bun run dist/app.js",
    "dev": "bun run --watch src/app.ts",
    "test": "bun test",
    "test:integration": "bun test tests/integration/",
    "health": "curl http://localhost:8002/api/health"
  },
  "dependencies": {
    "elysia": "latest",
    "@elysiajs/cors": "latest",
    "@elysiajs/swagger": "latest",
    "elysia-helmet": "latest", 
    "neo4j-driver": "^5.15.0",
    "zod": "^3.22.4",
    "uuid": "^9.0.1"
  },
  "devDependencies": {
    "@types/uuid": "^9.0.7",
    "bun-types": "latest",
    "typescript": "^5.3.0"
  }
}
```

#### **1.3 Railway Template Optimized Config**

**File: `apps/neo4j-service/src/config/neo4j.config.ts`**
```typescript
import neo4j, { Driver, Config, Session } from 'neo4j-driver';

let driverInstance: Driver | null = null;
let isConnected: boolean = false;

export const createNeo4jDriver = (): Driver => {
  // Railway template environment variables (different naming!)
  const uri = process.env.NEO4J_URI; // Railway internal TCP address
  const user = process.env.NEO4J_USER || 'neo4j';
  const password = process.env.NEO4J_PASSWORD || process.env.DB_PASSWORD; // Railway uses DB_PASSWORD
  const database = process.env.NEO4J_DATABASE || 'neo4j';

  if (!uri || !password) {
    console.error('‚ùå Railway Neo4j configuration missing:');
    console.error(`   NEO4J_URI: ${uri ? 'SET' : 'MISSING'}`);
    console.error(`   NEO4J_PASSWORD or DB_PASSWORD: ${password ? 'SET' : 'MISSING'}`);
    throw new Error('Railway Neo4j configuration incomplete');
  }

  // Railway template optimized config (internal networking)
  const config: Config = {
    maxConnectionLifetime: 30 * 60 * 1000, // 30 minutes
    maxConnectionPoolSize: 20, // Railway internal - can be generous
    connectionAcquisitionTimeout: 8000, // 8 seconds (Railway internal is fast)
    maxTransactionRetryTime: 15000, // 15 seconds
    fetchSize: 1000,
    disableLosslessIntegers: true,
    logging: {
      level: 'info',
      logger: (level, message) => {
        const timestamp = new Date().toISOString();
        console.log(`[${timestamp}] [Railway-Neo4j-${level.toUpperCase()}] ${message}`);
      }
    }
  };

  console.log(`üöÄ Connecting to Railway Neo4j Template: ${uri}`);
  console.log(`üìä Database: ${database}`);
  console.log(`üîó Using Railway internal networking`);
  
  return neo4j.driver(uri, neo4j.auth.basic(user, password), config);
};

export const initializeNeo4j = async (): Promise<void> => {
  try {
    driverInstance = createNeo4jDriver();
    
    // Verify Railway Neo4j connection
    const session = driverInstance.session();
    await session.run('RETURN 1 as railway_health_check');
    await session.close();
    
    isConnected = true;
    console.log('‚úÖ Railway Neo4j Template connection verified successfully!');
    console.log('üéØ Ready to serve graph operations via Railway internal network');
  } catch (error) {
    isConnected = false;
    console.error('‚ùå Railway Neo4j Template connection failed:', error);
    console.error('üîß Check Railway Neo4j service is running and TCP address is correct');
    throw error;
  }
};

export const getNeo4jDriver = (): Driver => {
  if (!driverInstance) {
    throw new Error('Railway Neo4j driver not initialized');
  }
  return driverInstance;
};

export const isNeo4jConnected = (): boolean => isConnected;

export const createSession = (database?: string): Session => {
  const driver = getNeo4jDriver();
  return driver.session({ 
    database: database || process.env.NEO4J_DATABASE || 'neo4j' 
  });
};

export const closeNeo4jDriver = async (): Promise<void> => {
  if (driverInstance) {
    await driverInstance.close();
    driverInstance = null;
    isConnected = false;
    console.log('üîå Railway Neo4j driver closed gracefully');
  }
};
```

#### **1.4 Environment Validation for Railway**

**File: `apps/neo4j-service/src/config/env.validation.ts`**
```typescript
import { z } from 'zod';

const RailwayNeo4jEnvSchema = z.object({
  NODE_ENV: z.enum(['development', 'production', 'test']).default('production'),
  PORT: z.string().default('8002'),
  
  // Railway Neo4j Template variables
  NEO4J_URI: z.string().min(1, 'Railway Neo4j URI required (neo4j://...)'),
  NEO4J_USER: z.string().default('neo4j'),
  NEO4J_PASSWORD: z.string().min(8, 'Railway Neo4j password required (min 8 chars)'),
  NEO4J_DATABASE: z.string().default('neo4j'),
  
  // Optional Railway template features
  NODE_CSV_URLS: z.string().optional(),
  RELATION_CSV_URLS: z.string().optional(),
  DB_PASSWORD: z.string().optional(), // Railway template uses this name
});

export type RailwayNeo4jEnv = z.infer<typeof RailwayNeo4jEnvSchema>;

export const validateEnvironment = (): RailwayNeo4jEnv => {
  try {
    const config = RailwayNeo4jEnvSchema.parse(process.env);
    
    console.log('‚úÖ Railway Neo4j environment validated');
    console.log(`üöÄ Service Port: ${config.PORT}`);
    console.log(`üîó Neo4j URI: ${config.NEO4J_URI}`);
    console.log(`üìä Database: ${config.NEO4J_DATABASE}`);
    console.log(`üéØ Environment: ${config.NODE_ENV}`);
    
    // Warn if using external URI (should be Railway internal)
    if (config.NEO4J_URI.includes('databases.neo4j.io')) {
      console.warn('‚ö†Ô∏è  WARNING: Still using external AuraDB instead of Railway template!');
      console.warn('üîß Expected Railway URI format: neo4j://xxx.railway.internal:7687');
    }
    
    return config;
  } catch (error) {
    console.error('‚ùå Railway Neo4j environment validation failed:');
    if (error instanceof z.ZodError) {
      error.errors.forEach(err => {
        console.error(`   ${err.path.join('.')}: ${err.message}`);
      });
    }
    console.error('\nüîß Required Railway Neo4j environment variables:');
    console.error('   NEO4J_URI (Railway TCP address: neo4j://xxx.railway.internal:7687)');
    console.error('   NEO4J_PASSWORD (Railway auto-generated or custom)');
    console.error('   PORT (default: 8002)');
    throw new Error('Invalid Railway Neo4j environment configuration');
  }
};
```

### **Phase 2: Railway Template Integration**

#### **2.1 Service Implementation with Railway Features**

**File: `apps/neo4j-service/src/services/neo4j.service.ts`**
```typescript
import { createSession } from '../config/neo4j.config';
import type { ConceptNode, SearchResult } from '../types/neo4j.types';

export class RailwayNeo4jService {
  
  async healthCheck(): Promise<{ status: string; railway: boolean; template: boolean; metrics: any }> {
    const session = createSession();
    
    try {
      // Test Railway Neo4j template connectivity
      await session.run('RETURN 1 as railway_test');
      
      // Get Railway Neo4j metrics
      const [conceptsResult, dbInfoResult] = await Promise.all([
        session.run('MATCH (c:Concept) RETURN count(c) as totalConcepts'),
        session.run('CALL dbms.components() YIELD name, versions RETURN name, versions[0] as version')
      ]);
      
      const totalConcepts = conceptsResult.records[0]?.get('totalConcepts').toNumber() || 0;
      const dbInfo = dbInfoResult.records[0];
      
      return {
        status: 'healthy',
        railway: true,
        template: true,
        metrics: {
          total_concepts: totalConcepts,
          neo4j_version: dbInfo?.get('version') || 'unknown',
          railway_internal: true,
          connection_type: 'Railway Template',
          timestamp: new Date().toISOString()
        }
      };
    } catch (error) {
      console.error('Railway Neo4j health check failed:', error);
      return {
        status: 'unhealthy',
        railway: false,
        template: false,
        metrics: {
          error: error instanceof Error ? error.message : 'Unknown error',
          timestamp: new Date().toISOString()
        }
      };
    } finally {
      await session.close();
    }
  }

  async searchConcepts(userId: string, query: string, limit = 5): Promise<SearchResult[]> {
    const session = createSession();
    
    try {
      const result = await session.run(
        `
        MATCH (c:Concept)
        WHERE c.user_id = $userId
        AND (c.name CONTAINS $query OR c.content CONTAINS $query OR c.description CONTAINS $query)
        WITH c, labels(c) as nodeLabels,
             CASE 
               WHEN c.name CONTAINS $query THEN 3
               WHEN c.content CONTAINS $query THEN 2
               WHEN c.description CONTAINS $query THEN 1
               ELSE 0
             END AS relevance
        WHERE relevance > 0
        RETURN c, nodeLabels, relevance
        ORDER BY relevance DESC, c.last_mentioned DESC
        LIMIT $limit
        `,
        { userId, query, limit }
      );
      
      return result.records.map(record => {
        const node = record.get('c');
        const labels = record.get('nodeLabels');
        const relevance = record.get('relevance');
        
        return {
          id: node.identity.toString(),
          labels,
          properties: { 
            ...node.properties, 
            relevance: relevance.toNumber(),
            source: 'railway_template'
          },
          score: relevance.toNumber() / 3.0
        };
      });
    } finally {
      await session.close();
    }
  }

  // Include CSV bulk import capability from Railway template
  async bulkImportFromCSV(nodeUrls?: string[], relationUrls?: string[]): Promise<{ imported: number; errors: string[] }> {
    if (!nodeUrls?.length && !relationUrls?.length) {
      return { imported: 0, errors: ['No CSV URLs provided'] };
    }

    const session = createSession();
    let imported = 0;
    const errors: string[] = [];

    try {
      // Import nodes from CSV URLs (Railway template feature)
      if (nodeUrls?.length) {
        for (const url of nodeUrls) {
          try {
            const result = await session.run(
              `LOAD CSV WITH HEADERS FROM $url AS row
               CREATE (n:ImportedNode)
               SET n = row
               RETURN count(n) as imported`,
              { url }
            );
            imported += result.records[0]?.get('imported').toNumber() || 0;
          } catch (error) {
            errors.push(`Node CSV ${url}: ${error instanceof Error ? error.message : 'Unknown error'}`);
          }
        }
      }

      // Import relationships from CSV URLs (Railway template feature)
      if (relationUrls?.length) {
        for (const url of relationUrls) {
          try {
            const result = await session.run(
              `LOAD CSV WITH HEADERS FROM $url AS row
               MATCH (a), (b)
               WHERE a.id = row.from_id AND b.id = row.to_id
               CREATE (a)-[r:IMPORTED_RELATION]->(b)
               SET r = row
               RETURN count(r) as imported`,
              { url }
            );
            imported += result.records[0]?.get('imported').toNumber() || 0;
          } catch (error) {
            errors.push(`Relation CSV ${url}: ${error instanceof Error ? error.message : 'Unknown error'}`);
          }
        }
      }

      return { imported, errors };
    } finally {
      await session.close();
    }
  }
}

export const railwayNeo4jService = new RailwayNeo4jService();
```

### **Phase 3: Railway Deployment Configuration**

#### **3.1 Railway Service Configuration**

**File: `apps/neo4j-service/railway.toml`**
```toml
[build]
builder = "dockerfile"

[deploy]
restartPolicyType = "always"
healthcheckPath = "/api/health"
healthcheckTimeout = 30

[env]
NODE_ENV = "production"
PORT = "8002"

# Railway Neo4j Template connection (link to your deployed template)
NEO4J_URI = "${{NEO4J_TEMPLATE.NEO4J_URI}}"       # Link to Railway template
NEO4J_USER = "${{NEO4J_TEMPLATE.NEO4J_USER}}"     # Default: neo4j  
NEO4J_PASSWORD = "${{NEO4J_TEMPLATE.DB_PASSWORD}}" # Railway template password
NEO4J_DATABASE = "neo4j"

# Railway template CSV import features (optional)
NODE_CSV_URLS = "${{NEO4J_TEMPLATE.NODE_CSV_URLS}}"
RELATION_CSV_URLS = "${{NEO4J_TEMPLATE.RELATION_CSV_URLS}}"
```

#### **3.2 Update omnii_mcp for Railway Integration**

**File: `apps/omnii_mcp/src/services/neo4j-client.ts`**
```typescript
export class RailwayNeo4jClient {
  private config: {
    baseUrl: string;
    timeout: number;
    retries: number;
  };

  constructor() {
    this.config = {
      baseUrl: this.getServiceUrl(),
      timeout: 5000, // Railway internal networking is fast
      retries: 3
    };
  }

  private getServiceUrl(): string {
    if (process.env.RAILWAY_ENVIRONMENT) {
      // Railway internal service URL
      return 'http://neo4j-service-production.railway.internal:8002';
    }
    // Local development
    return process.env.NEO4J_SERVICE_URL || 'http://localhost:8002';
  }

  async healthCheck() {
    try {
      const response = await this.makeRequest('/api/health');
      
      // Log Railway template status
      if (response.railway && response.template) {
        console.log('‚úÖ Railway Neo4j Template healthy');
      } else {
        console.warn('‚ö†Ô∏è  Railway Neo4j Template issues detected');
      }
      
      return response;
    } catch (error) {
      console.error('‚ùå Railway Neo4j service unavailable:', error);
      return { status: 'unavailable', railway: false, template: false };
    }
  }

  async searchConcepts(userId: string, query: string, limit = 5) {
    return this.makeRequest('/api/search/concepts', {
      method: 'POST',
      body: JSON.stringify({ userId, query, limit })
    });
  }

  private async makeRequest(endpoint: string, options: RequestInit = {}) {
    const url = `${this.config.baseUrl}${endpoint}`;
    
    const response = await fetch(url, {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        'X-Source': 'omnii-mcp',
        'X-Railway-Internal': process.env.RAILWAY_ENVIRONMENT ? 'true' : 'false',
        ...options.headers
      },
      signal: AbortSignal.timeout(this.config.timeout)
    });

    if (!response.ok) {
      throw new Error(`Railway Neo4j service error: ${response.status} ${response.statusText}`);
    }

    return await response.json();
  }
}
```

### **Phase 4: Environment Variables Configuration**

#### **4.1 Railway Neo4j Service Environment**
```bash
# Get these from your Railway Neo4j Template dashboard:
NEO4J_URI=neo4j://your-railway-tcp-address.railway.internal:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=t5aasc8n01smso1liiss5b6clu8z5q97  # From Railway template
NEO4J_DATABASE=neo4j
PORT=8002
NODE_ENV=production
```

#### **4.2 omnii_mcp Environment Update**
```bash
# Remove old AuraDB variables completely:
# NEO4J_URI="bolt+s://d066c29d.databases.neo4j.io:7687"  # ‚ùå REMOVE
# NEO4J_PASSWORD="_o0JebFPkSb51lSjC7BUqdsvDhD4e5bYGFV1uoVv3QE"  # ‚ùå REMOVE

# Add Railway Neo4j service connection:
NEO4J_SERVICE_URL=http://neo4j-service-production.railway.internal:8002
NEO4J_SERVICE_TIMEOUT=5000
RAILWAY_NEO4J_ENABLED=true
```

## ‚úÖ **Updated Success Criteria**

- [ ] ‚úÖ Railway Neo4j template deployed and running
- [ ] Switch from external AuraDB to Railway template connection
- [ ] Neo4j service connects to Railway template successfully  
- [ ] omnii_mcp communicates with neo4j-service via Railway internal network
- [ ] All existing Neo4j functionality preserved and enhanced
- [ ] Response times <100ms for Railway internal calls
- [ ] Health monitoring shows Railway template status
- [ ] CSV bulk import capability available (Railway template feature)

## üß™ **Updated Testing Plan**

### **Step 1: Verify Railway Template Connection**
```bash
# First test Railway template directly in omnii_mcp
# Update apps/omnii_mcp/.env temporarily:
NEO4J_URI=neo4j://your-railway-tcp-address.railway.internal:7687
NEO4J_PASSWORD=t5aasc8n01smso1liiss5b6clu8z5q97

cd apps/omnii_mcp  
npm run dev
# Check logs for successful Railway connection
```

### **Step 2: Test Neo4j Service**
```bash
cd apps/neo4j-service
npm run dev

# Health check
curl http://localhost:8002/api/health
# Should show: railway: true, template: true
```

### **Step 3: Test Integration**
```bash
# Test omnii_mcp ‚Üí neo4j-service ‚Üí Railway template
curl http://localhost:8000/api/brain/health
```

## üö® **Critical Next Steps**

1. **üîß IMMEDIATELY**: Get Railway Neo4j TCP address from your template dashboard
2. **üîÑ SWITCH**: Update environment variables from AuraDB to Railway template  
3. **‚úÖ TEST**: Verify Railway template connection before proceeding
4. **üì¶ BUILD**: Create neo4j-service with Railway optimizations
5. **üöÄ DEPLOY**: Deploy and test full integration

The key is switching from external AuraDB (`bolt+s://d066c29d.databases.neo4j.io:7687`) to Railway template (`neo4j://xxx.railway.internal:7687`) first! üéØ