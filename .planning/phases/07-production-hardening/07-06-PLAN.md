---
phase: 07-production-hardening
plan: 06
type: execute
wave: 3
depends_on: ["07-01", "07-02", "07-03", "07-04", "07-05"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Backend starts with Sentry and telemetry initialized"
    - "API latency metrics are logged for each request"
    - "Push notification infrastructure is ready on mobile"
    - "Adaptive sync adjusts frequency based on network"
    - "Version history can be created and rolled back"
    - "Data can be exported in JSON, CSV, and Markdown"
  artifacts:
    - path: "apps/omnii_mcp/src/services/observability/index.ts"
      provides: "Backend observability"
      min_lines: 5
    - path: "apps/omnii-mobile/src/services/notifications/index.ts"
      provides: "Push notification services"
      min_lines: 5
    - path: "apps/omnii-mobile/src/services/sync/index.ts"
      provides: "Adaptive sync controller"
      min_lines: 5
    - path: "apps/omnii_mcp/src/graph/versioning/index.ts"
      provides: "Version history operations"
      min_lines: 5
    - path: "apps/omnii_mcp/src/services/export/index.ts"
      provides: "Data export service"
      min_lines: 5
  key_links:
    - from: "apps/omnii_mcp/src/index.ts"
      to: "services/observability"
      via: "initSentry() call"
      pattern: "initSentry"
---

<objective>
Verify all Phase 7 success criteria are met through end-to-end testing and human verification.

Purpose: Ensure all 6 success criteria for Phase 7 are working before marking phase complete.
Output: Verified Phase 7 is production-ready with all features functional.
</objective>

<execution_context>
@/Users/santino/.claude/get-shit-done/workflows/execute-plan.md
@/Users/santino/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-production-hardening/07-RESEARCH.md

Prior plans delivered:
- 07-01: Backend Sentry and performance monitoring
- 07-02: Mobile Sentry and push notifications
- 07-03: Adaptive sync controller
- 07-04: Neo4j version history
- 07-05: Data export
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify backend compilation and startup</name>
  <files></files>
  <action>
Run compilation and startup checks for the backend:

```bash
cd apps/omnii_mcp

# TypeScript compilation
bun run check

# Build verification
bun run build

# Module count check (should be similar to Phase 6: ~4400 modules)
bun run dev &
sleep 5
pkill -f "bun.*dev" || true
```

Check that:
1. TypeScript compiles without errors
2. Build succeeds
3. App starts and logs Sentry initialization (or warning if no DSN)
4. API latency middleware is active

Record module count and any warnings.
  </action>
  <verify>bun run check exits 0, app starts without errors</verify>
  <done>Backend compiles and starts with observability initialized</done>
</task>

<task type="auto">
  <name>Task 2: Verify mobile compilation</name>
  <files></files>
  <action>
Run TypeScript compilation check for mobile app:

```bash
cd apps/omnii-mobile

# TypeScript check
npx tsc --noEmit

# Verify packages installed
grep -E "sentry|expo-notifications|netinfo" package.json
```

Note: Full mobile testing requires physical device due to push notifications. This task verifies:
1. TypeScript compiles without errors
2. All dependencies are installed
3. Notification services export correctly
4. Adaptive sync services export correctly
  </action>
  <verify>npx tsc --noEmit exits 0</verify>
  <done>Mobile app compiles with notification and sync services</done>
</task>

<task type="auto">
  <name>Task 3: Verify version history and export endpoints</name>
  <files></files>
  <action>
Test version history and export endpoints are registered and responding:

```bash
cd apps/omnii_mcp

# Start server in background
bun run dev &
SERVER_PID=$!
sleep 3

# Check routes are registered (via health endpoints or Swagger)
curl -s http://localhost:3000/api/versions/test-id || echo "versions endpoint exists"
curl -s http://localhost:3000/api/export/health || echo "export endpoint exists"

# Cleanup
kill $SERVER_PID 2>/dev/null || true
```

If INGESTION_TEST_MODE is enabled, also test:
```bash
# Create test entity and version
curl -X POST http://localhost:3000/api/test/inject/contacts \
  -H "Content-Type: application/json" \
  -d '{"contacts": [{"name": "Test User", "email": "test@example.com"}]}'

# Create version
curl -X POST "http://localhost:3000/api/versions/[entity-id]" \
  -H "Content-Type: application/json" \
  -d '{"entityType": "Contact", "data": {"name": "Updated"}, "createdBy": "user"}'

# Get history
curl "http://localhost:3000/api/versions/[entity-id]"

# Test export
curl "http://localhost:3000/api/export?userId=test&format=json"
```
  </action>
  <verify>Version and export endpoints return valid responses</verify>
  <done>Version history and export endpoints verified</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Phase 7 Production Hardening features:
1. Backend Sentry error tracking and OpenTelemetry performance monitoring
2. Mobile Sentry error tracking and Expo push notification infrastructure
3. Adaptive sync controller that adjusts frequency based on network conditions
4. Neo4j version history with rollback capability
5. GDPR-compliant data export in JSON, CSV, and Markdown formats
  </what-built>
  <how-to-verify>
**Verification Checklist:**

1. **Backend Observability (Success Criteria 3 & 4)**
   - [ ] Run `cd apps/omnii_mcp && bun run dev`
   - [ ] Check logs show "[Sentry] Initialized" (or "[Sentry] No DSN configured" if no DSN set)
   - [ ] Make request to `/health` and verify `api_latency` metric logged to console

2. **Mobile Compilation (Success Criteria 1 & 3)**
   - [ ] Run `cd apps/omnii-mobile && npx tsc --noEmit` - compiles without errors
   - [ ] Verify `src/services/notifications/` directory exists with 4 files
   - [ ] Verify `src/lib/sentry.ts` exists

3. **Adaptive Sync (Success Criteria 2)**
   - [ ] Verify `src/services/sync/` directory exists with 3 files
   - [ ] Check `adaptive-controller.ts` has frequency states: realtime, frequent, conservative, paused

4. **Version History (Success Criteria 6)**
   - [ ] Verify `/api/versions/:entityId` endpoint exists in Swagger
   - [ ] Verify `/api/versions/:entityId/rollback/:version` endpoint exists

5. **Data Export (Success Criteria 5)**
   - [ ] Run `curl http://localhost:3000/api/export/health` returns formats array
   - [ ] Verify export endpoint accepts format=json, format=csv, format=markdown

**Note:** Full push notification testing requires physical device and EAS project ID. Full Sentry testing requires SENTRY_DSN configured.
  </how-to-verify>
  <resume-signal>Type "verified" to confirm all criteria pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Phase 7 Success Criteria from ROADMAP.md:

1. Push notifications work on mobile for important events - READY (infrastructure in place, requires physical device to fully test)
2. Adaptive sync frequency adjusts based on user activity and network conditions - IMPLEMENTED
3. Error tracking (Sentry) captures and reports production issues - IMPLEMENTED (backend + mobile)
4. Performance monitoring tracks API latency, graph query performance, sync duration - IMPLEMENTED
5. Data export functionality allows user to download data in JSON, Markdown, or CSV - IMPLEMENTED
6. User can view version history and rollback AI-generated changes - IMPLEMENTED
</verification>

<success_criteria>
- Backend compiles and starts with observability services
- Mobile compiles with notification and sync services
- Version history endpoints are accessible
- Export endpoints return proper content types
- Human verification confirms all 6 success criteria are met
</success_criteria>

<output>
After completion, create `.planning/phases/07-production-hardening/07-06-SUMMARY.md`

This completes Phase 7 and the entire v1 roadmap.
</output>
