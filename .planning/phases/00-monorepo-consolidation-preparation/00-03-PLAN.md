---
phase: 00-monorepo-consolidation-preparation
plan: 03
type: execute
wave: 3
depends_on: ["00-02"]
files_modified:
  - /Users/santino/Projects/Omnii One/apps/omnii_mcp/ (merged content from standalone)
autonomous: true

must_haves:
  truths:
    - "Standalone omnii-mcp unique features identified and merged"
    - "Git history from standalone omnii-mcp preserved"
    - "MCP server starts without errors after merge"
  artifacts:
    - path: "/Users/santino/Projects/Omnii One/apps/omnii_mcp/package.json"
      provides: "MCP package with all features"
      contains: "@omnii/omnii_mcp"
    - path: "/Users/santino/Projects/Omnii One/.planning/phases/00-monorepo-consolidation-preparation/00-MCP-MERGE-REPORT.md"
      provides: "Documentation of what was merged"
      min_lines: 30
  key_links:
    - from: "/Users/santino/Projects/Omnii One/apps/omnii_mcp/src/app.ts"
      to: "/Users/santino/Projects/Omnii One/packages/api"
      via: "workspace import"
      pattern: "@omnii/api"
---

<objective>
Merge unique features from standalone omnii-mcp into the workspace version.

Purpose: The standalone omnii-mcp may have diverged with features not in apps/omnii_mcp. Identify and merge those features while preserving the workspace integration.

Output: A unified MCP server with all features from both codebases, workspace:* dependencies intact.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/santino/Projects/Omnii One/.planning/PROJECT.md
@/Users/santino/Projects/Omnii One/.planning/phases/00-monorepo-consolidation-preparation/00-RESEARCH.md
@/Users/santino/Projects/Omnii One/.planning/phases/00-monorepo-consolidation-preparation/00-MERGE-STRATEGY.md

Source: /Users/santino/Projects/omnii-mcp (standalone)
Target: /Users/santino/Projects/Omnii One/apps/omnii_mcp (workspace version)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Diff and identify unique features in standalone</name>
  <files>
    /Users/santino/Projects/Omnii One/.planning/phases/00-monorepo-consolidation-preparation/00-MCP-DIFF.md
  </files>
  <action>
Compare the two MCP codebases to identify features unique to standalone:

1. Compare directory structures:
   ```bash
   diff -rq /Users/santino/Projects/omnii-mcp/src /Users/santino/Projects/Omnii\ One/apps/omnii_mcp/src 2>/dev/null || true
   ```

2. Compare package.json dependencies:
   ```bash
   diff /Users/santino/Projects/omnii-mcp/package.json /Users/santino/Projects/Omnii\ One/apps/omnii_mcp/package.json
   ```

3. Check git log dates to see which has newer commits:
   ```bash
   git -C /Users/santino/Projects/omnii-mcp log --oneline -5
   ```

4. Create 00-MCP-DIFF.md documenting:
   - Files only in standalone (unique features)
   - Files only in workspace (integrated features)
   - Files in both with differences
   - Dependency differences
   - Recommended merge actions for each difference

Focus on src/ directory - that's where feature code lives. Tests and scripts can be merged separately.

If standalone has NO unique features (is older/subset), document that finding - merge may not be needed.
  </action>
  <verify>
00-MCP-DIFF.md exists with clear comparison
Each difference has a recommended action (keep standalone, keep workspace, merge)
  </verify>
  <done>
Complete diff documented with merge recommendations for each difference.
  </done>
</task>

<task type="auto">
  <name>Task 2: Merge unique features with history preservation</name>
  <files>
    /Users/santino/Projects/Omnii One/apps/omnii_mcp/
    /Users/santino/Projects/Omnii One/.planning/phases/00-monorepo-consolidation-preparation/00-MCP-MERGE-REPORT.md
  </files>
  <action>
Based on Task 1 diff, merge unique features from standalone into workspace version:

**If standalone has unique features:**

1. Clone standalone and rewrite history to apps/omnii_mcp/:
   ```bash
   git clone /Users/santino/Projects/omnii-mcp /tmp/omnii-mcp-migrate
   cd /tmp/omnii-mcp-migrate
   git filter-repo --to-subdirectory-filter apps/omnii_mcp
   ```

2. Merge into target:
   ```bash
   cd "/Users/santino/Projects/Omnii One"
   git remote add mcp-source /tmp/omnii-mcp-migrate
   git fetch mcp-source
   git merge mcp-source/main --allow-unrelated-histories -m "Merge omnii-mcp standalone with history

   Preserves git history from /Users/santino/Projects/omnii-mcp
   Unique features merged into apps/omnii_mcp/"
   ```

3. Resolve any merge conflicts, preferring workspace:* dependencies.

4. Clean up:
   ```bash
   git remote remove mcp-source
   rm -rf /tmp/omnii-mcp-migrate
   ```

**If standalone has NO unique features (is older/subset):**
- Skip git merge
- Document in report that workspace version is already canonical
- Optionally cherry-pick any specific commits worth preserving

**After merge (either case):**
5. Ensure package.json keeps @omnii/omnii_mcp name and workspace:* deps
6. Run: `pnpm install` to update lockfile
7. Test: `cd apps/omnii_mcp && bun run dev` starts without errors (Ctrl+C after confirming startup)

Create 00-MCP-MERGE-REPORT.md documenting:
- What was merged (files, features)
- What conflicts occurred and how resolved
- Current state of apps/omnii_mcp
  </action>
  <verify>
Run: `git log --oneline apps/omnii_mcp/ | head -10` shows history from both sources (or just workspace if no merge needed)
Run: `cat apps/omnii_mcp/package.json | grep "@omnii"` shows workspace:* deps intact
Run: `cd apps/omnii_mcp && bun run dev` starts (check for startup message, then Ctrl+C)
00-MCP-MERGE-REPORT.md exists
  </verify>
  <done>
MCP server unified - either merged with standalone features or confirmed workspace version is canonical. Server starts successfully. Report documents what happened.
  </done>
</task>

</tasks>

<verification>
1. History preserved (if merge occurred):
   ```bash
   git log --all --oneline | grep -i mcp | head -5
   ```

2. Workspace integration intact:
   ```bash
   grep "workspace:" apps/omnii_mcp/package.json
   ```

3. MCP server runs:
   ```bash
   cd apps/omnii_mcp && timeout 10 bun run dev || true  # Should start then timeout
   ```

4. Documentation complete:
   ```bash
   ls .planning/phases/00-monorepo-consolidation-preparation/00-MCP-*.md
   ```
</verification>

<success_criteria>
- Unique features from standalone omnii-mcp are in apps/omnii_mcp (or documented why none exist)
- Git history preserved for merged content
- apps/omnii_mcp/package.json still uses @omnii scope and workspace:* dependencies
- MCP server starts without errors (may not fully run without env vars - startup is enough)
- Merge report documents what was done
</success_criteria>

<output>
After completion, create `.planning/phases/00-monorepo-consolidation-preparation/00-03-SUMMARY.md`
</output>
