---
phase: 00-monorepo-consolidation-preparation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /Users/santino/Projects/Omnii One/apps/
  - /Users/santino/Projects/Omnii One/packages/
  - /Users/santino/Projects/Omnii One/tooling/
  - /Users/santino/Projects/Omnii One/package.json
  - /Users/santino/Projects/Omnii One/pnpm-workspace.yaml
  - /Users/santino/Projects/Omnii One/turbo.json
  - /Users/santino/Projects/Omnii One/.npmrc
autonomous: true

must_haves:
  truths:
    - "Target monorepo inherits omnii's Turborepo configuration"
    - "Git history from omnii is fully preserved"
    - "turbo dev runs without errors in target directory"
  artifacts:
    - path: "/Users/santino/Projects/Omnii One/package.json"
      provides: "Root package.json with Turborepo scripts"
      contains: "turbo"
    - path: "/Users/santino/Projects/Omnii One/turbo.json"
      provides: "Turborepo task configuration"
      contains: "tasks"
    - path: "/Users/santino/Projects/Omnii One/pnpm-workspace.yaml"
      provides: "Workspace definitions"
      contains: "packages"
  key_links:
    - from: "/Users/santino/Projects/Omnii One/package.json"
      to: "turbo.json"
      via: "scripts calling turbo"
      pattern: "turbo (run|watch)"
---

<objective>
Bootstrap monorepo target by migrating the omnii codebase with full git history preservation.

Purpose: Establish the monorepo foundation using omnii's existing Turborepo setup as the base, preserving all git history to avoid the "lost history" pitfall that blocks future debugging and attribution.

Output: A working Turborepo monorepo at /Users/santino/Projects/Omnii One/ with all omnii apps, packages, and tooling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/santino/Projects/Omnii One/.planning/PROJECT.md
@/Users/santino/Projects/Omnii One/.planning/ROADMAP.md
@/Users/santino/Projects/Omnii One/.planning/STATE.md
@/Users/santino/Projects/Omnii One/.planning/phases/00-monorepo-consolidation-preparation/00-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate omnii codebase with git history</name>
  <files>
    /Users/santino/Projects/Omnii One/ (all files from omnii)
  </files>
  <action>
Use git filter-repo to migrate the omnii codebase into the target directory while preserving full git history.

Steps:
1. Clone omnii to a temp directory:
   ```bash
   git clone /Users/santino/Projects/omnii /tmp/omnii-migrate
   ```

2. The omnii repo is already at root level (apps/, packages/, tooling/), so NO subdirectory rewrite needed - files stay at root.

3. Add as remote to Omnii One and merge with history:
   ```bash
   cd "/Users/santino/Projects/Omnii One"
   git remote add omnii-source /tmp/omnii-migrate
   git fetch omnii-source
   git merge omnii-source/main --allow-unrelated-histories -m "Merge omnii monorepo with full git history

   Preserves complete commit history from /Users/santino/Projects/omnii
   Base for Omnii One consolidation project"
   ```

4. Clean up:
   ```bash
   git remote remove omnii-source
   rm -rf /tmp/omnii-migrate
   ```

IMPORTANT: Do NOT use `--squash` - this destroys history. Use `--allow-unrelated-histories` to preserve all commits.
  </action>
  <verify>
Run: `git log --oneline | head -20` in target directory - should show original omnii commits, not just merge commit.
Run: `ls -la` - should show apps/, packages/, tooling/, package.json, turbo.json
  </verify>
  <done>
Target directory contains full omnii codebase with git history preserved (git log shows original commits, git blame works on all files).
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate Turborepo configuration and install dependencies</name>
  <files>
    /Users/santino/Projects/Omnii One/package.json
    /Users/santino/Projects/Omnii One/.npmrc
  </files>
  <action>
Verify the migrated Turborepo configuration works:

1. Check pnpm is available (required by package.json packageManager field):
   ```bash
   pnpm --version  # Should be 10.x per package.json
   ```

2. Create/verify .npmrc for React Native hoisting (required per research):
   ```ini
   node-linker=hoisted
   shamefully-hoist=true
   auto-install-peers=true
   ```

3. Install dependencies:
   ```bash
   cd "/Users/santino/Projects/Omnii One"
   pnpm install
   ```

4. Verify Turborepo works:
   ```bash
   pnpm turbo --version
   pnpm lint:ws  # Sherif workspace validation
   ```

Do NOT run full dev yet - focus on dependency installation and basic Turborepo health check.
  </action>
  <verify>
Run: `pnpm lint:ws` exits 0 (no workspace errors)
Run: `pnpm turbo --version` shows 2.5.x
Run: `ls node_modules/.pnpm` confirms dependencies installed
  </verify>
  <done>
Dependencies installed, Turborepo responds to commands, workspace validation passes.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Git history preserved:
   ```bash
   git log --oneline apps/omnii_mcp/ | head -5  # Shows original commits, not just merge
   ```

2. Turborepo functional:
   ```bash
   pnpm turbo build --dry-run  # Shows task graph without running
   ```

3. Directory structure correct:
   ```bash
   ls apps/  # omnii_mcp, omnii-mobile, omnii-neo4j, python-rdf
   ls packages/  # api, auth, db, ui, validators
   ls tooling/  # eslint, github, prettier, tailwind, typescript
   ```
</verification>

<success_criteria>
- omnii codebase fully migrated with git history (git log shows historical commits)
- Turborepo configuration works (turbo commands execute)
- Dependencies install without errors (pnpm install succeeds)
- Workspace validation passes (sherif finds no issues)
</success_criteria>

<output>
After completion, create `.planning/phases/00-monorepo-consolidation-preparation/00-01-SUMMARY.md`
</output>
