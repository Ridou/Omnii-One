---
phase: 00-monorepo-consolidation-preparation
plan: 05
type: execute
wave: 4
depends_on: ["00-03", "00-04"]
files_modified:
  - /Users/santino/Projects/Omnii One/package.json
  - /Users/santino/Projects/Omnii One/.syncpackrc.json
autonomous: true

must_haves:
  truths:
    - "Turborepo dev command starts all apps without errors"
    - "Syncpack validates no version mismatches"
    - "Workspace relationships resolve correctly"
  artifacts:
    - path: "/Users/santino/Projects/Omnii One/.syncpackrc.json"
      provides: "Version policy enforcement"
      contains: "versionGroups"
    - path: "/Users/santino/Projects/Omnii One/package.json"
      provides: "Root package with resolutions"
      contains: "resolutions"
  key_links:
    - from: "/Users/santino/Projects/Omnii One/apps/omnii_mcp/package.json"
      to: "/Users/santino/Projects/Omnii One/packages/api"
      via: "workspace:* dependency"
      pattern: "workspace:\\*"
---

<objective>
Validate monorepo tooling works end-to-end and configure version enforcement.

Purpose: Prove the consolidated monorepo is functional before Phase 1 begins. Catch any Turborepo or workspace issues now, not during feature development.

Output: Working monorepo with Turborepo, validated dependencies, version enforcement via Syncpack.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/santino/Projects/Omnii One/.planning/PROJECT.md
@/Users/santino/Projects/Omnii One/.planning/phases/00-monorepo-consolidation-preparation/00-RESEARCH.md
@/Users/santino/Projects/Omnii One/.planning/phases/00-monorepo-consolidation-preparation/00-MERGE-STRATEGY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Syncpack for version enforcement</name>
  <files>
    /Users/santino/Projects/Omnii One/.syncpackrc.json
    /Users/santino/Projects/Omnii One/package.json
  </files>
  <action>
Set up Syncpack to enforce the Single Version Policy from research:

1. Create .syncpackrc.json:
```json
{
  "versionGroups": [
    {
      "label": "React ecosystem must match exactly",
      "packages": ["**"],
      "dependencies": ["react", "react-dom", "react-native"],
      "policy": "sameRange"
    },
    {
      "label": "Expo must match exactly",
      "packages": ["**"],
      "dependencies": ["expo", "expo-*"],
      "policy": "sameRange"
    },
    {
      "label": "Use workspace protocol for internal packages",
      "packages": ["**"],
      "dependencies": ["@omnii/*"],
      "dependencyTypes": ["dev", "prod"],
      "policy": "workspace"
    }
  ],
  "semverGroups": [
    {
      "label": "Pin exact versions for build tools",
      "packages": ["**"],
      "dependencies": ["turbo", "typescript"],
      "range": ""
    }
  ]
}
```

2. Ensure root package.json has resolutions for React ecosystem:
```json
{
  "resolutions": {
    "react": "19.0.0",
    "react-dom": "19.0.0",
    "react-native": "0.79.3"
  },
  "pnpm": {
    "overrides": {
      "react": "19.0.0",
      "react-dom": "19.0.0",
      "react-native": "0.79.3"
    }
  }
}
```

3. Add syncpack as dev dependency if not present:
   ```bash
   pnpm add -D syncpack -w
   ```

4. Add lint:deps script:
   ```json
   "scripts": {
     "lint:deps": "syncpack list-mismatches"
   }
   ```

5. Run validation:
   ```bash
   pnpm lint:deps
   ```

Fix any version mismatches that syncpack identifies.
  </action>
  <verify>
Run: `cat .syncpackrc.json` shows version groups config
Run: `pnpm lint:deps` exits 0 (no mismatches) OR lists mismatches to fix
Run: `cat package.json | grep -A3 '"resolutions"'` shows pinned versions
  </verify>
  <done>
Syncpack configured with version policy. Any mismatches identified for fixing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate Turborepo functionality</name>
  <files>
    (validation only - no file changes)
  </files>
  <action>
Run comprehensive Turborepo validation:

1. Verify task graph:
   ```bash
   cd "/Users/santino/Projects/Omnii One"
   pnpm turbo build --dry-run --graph
   ```
   Should show all apps and packages in dependency order.

2. Run workspace lint:
   ```bash
   pnpm lint:ws
   ```
   Sherif should find no workspace issues.

3. Run typecheck across all packages:
   ```bash
   pnpm turbo typecheck --dry-run
   ```
   Should complete without errors.

4. Verify MCP backend starts:
   ```bash
   cd apps/omnii_mcp
   timeout 15 bun run dev 2>&1 || true
   ```
   Should show Elysia startup message (will fail on missing env vars - that's OK).

5. Document any issues found:
   - Missing peer dependencies
   - Workspace resolution failures
   - TypeScript errors

If issues found, fix them. Common fixes:
- Missing deps: `pnpm add -D <package> -w`
- Workspace issues: Check pnpm-workspace.yaml includes all paths
- Type errors: May need to run `pnpm turbo build` first for generated types

6. Final validation - parallel dev start:
   ```bash
   pnpm turbo dev --filter=@omnii/omnii_mcp --concurrency=1 &
   sleep 10
   kill %1 2>/dev/null || true
   ```
  </action>
  <verify>
Run: `pnpm turbo build --dry-run` completes and shows task graph
Run: `pnpm lint:ws` exits 0
Run: `pnpm lint:deps` exits 0 (or shows only expected mismatches)
  </verify>
  <done>
Turborepo validates all workspaces. Task graph shows correct dependencies. At least MCP server can start (with env var warnings acceptable).
  </done>
</task>

</tasks>

<verification>
1. Syncpack enforces version policy:
   ```bash
   pnpm lint:deps 2>&1 | head -10
   ```

2. Turborepo knows about all apps:
   ```bash
   pnpm turbo build --dry-run 2>&1 | grep "@omnii"
   ```

3. No workspace lint errors:
   ```bash
   pnpm lint:ws
   ```

4. Git status shows clean state (all changes committed):
   ```bash
   git status --short
   ```
</verification>

<success_criteria>
- Syncpack configured with React/Expo/workspace version policies
- Root package.json has resolutions for React ecosystem
- `pnpm lint:ws` passes (Sherif validation)
- `pnpm turbo build --dry-run` shows all workspaces
- At least one app (omnii_mcp) starts without immediate crash
- Phase 0 is ready to close - monorepo tooling validated
</success_criteria>

<output>
After completion, create `.planning/phases/00-monorepo-consolidation-preparation/00-05-SUMMARY.md`
</output>
