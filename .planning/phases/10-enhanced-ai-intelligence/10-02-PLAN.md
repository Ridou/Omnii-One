# Plan 10-02: Cross-Source Relationship Inference Engine

## Overview
Build inference engine that discovers relationships across different data sources (email, calendar, tasks, notes).

## Dependencies
- 10-01: Enhanced entity extraction
- Existing: `services/graphrag/relationship-discovery.ts`

## Tasks

### 1. Create relationship inference patterns
Create `apps/omnii_mcp/src/services/ai/inference-patterns.ts`:
- Pattern definitions:
  - `EMAIL_MEETING_ATTENDEE`: Email sender/recipient → Meeting attendee
  - `TASK_MEETING_FOLLOWUP`: Task created after meeting → Related to meeting
  - `NOTE_CONTACT_MENTION`: Note [[wikilink]] → Contact entity
  - `FILE_PROJECT_CONTEXT`: Document → Project from folder/metadata
  - `TEMPORAL_SEQUENCE`: Events within time window → Related
- Pattern matching with configurable confidence thresholds
- Pattern priority ordering

### 2. Create cross-source matcher
Create `apps/omnii_mcp/src/services/ai/cross-source-matcher.ts`:
- `matchAcrossSources()`: Find entity matches across source types
- `inferRelationship()`: Apply inference patterns to matched entities
- `validateInference()`: Confidence check on inferred relationships
- Graph traversal helpers for finding existing connections

### 3. Create relationship suggestion service
Create `apps/omnii_mcp/src/services/ai/relationship-suggestions.ts`:
- `generateSuggestions()`: Produce relationship suggestions from patterns
- `rankSuggestions()`: Sort by confidence and relevance
- `formatForApproval()`: Prepare suggestions for user review
- Suggested relationship includes: source entities, relationship type, confidence, evidence

### 4. Create suggestion approval storage
Create `apps/omnii_mcp/src/services/ai/suggestion-storage.ts`:
- Store pending suggestions in Neo4j with PENDING status
- Mark approved/rejected with user feedback
- Track approval patterns to improve future inference

### 5. Integrate with existing relationship discovery
Update `apps/omnii_mcp/src/services/graphrag/relationship-discovery.ts`:
- Call cross-source matcher after entity extraction
- Add inferred relationships to results
- Flag inferred vs extracted relationships

## Acceptance Criteria
- [ ] System infers email sender → meeting attendee relationships
- [ ] System suggests relationships with confidence scores
- [ ] Suggestions stored for user approval
- [ ] Approved relationships created in graph

## Wave
2 (depends on 10-01)
