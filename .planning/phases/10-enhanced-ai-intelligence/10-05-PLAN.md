# Plan 10-05: Analytics Pattern Engine

## Overview
Build analytics engine that detects actionable patterns from user data, not vanity metrics.

## Dependencies
- 10-01: Enhanced entity extraction
- Existing: Neo4j graph with event/task/email data

## Tasks

### 1. Create pattern definitions
Create `apps/omnii_mcp/src/services/analytics/pattern-definitions.ts`:
- PatternType enum:
  - `MEETING_FOLLOWUP_RATE`: "3pm meetings → 40% more follow-up tasks"
  - `EMAIL_RESPONSE_TIME`: "Responds to X 2x faster than average"
  - `TASK_COMPLETION_VELOCITY`: "Tasks created Mon complete 30% faster"
  - `MEETING_DURATION_DRIFT`: "Recurring meetings running 15% longer"
  - `COLLABORATION_CLUSTERS`: "Works most with team A on project X"
  - `PRODUCTIVITY_WINDOWS`: "Most productive 9-11am"
- Pattern structure: name, query, threshold, actionableInsight

### 2. Create pattern detection engine
Create `apps/omnii_mcp/src/services/analytics/pattern-engine.ts`:
- `detectPatterns()`: Run all pattern queries
- `runPatternQuery()`: Execute Cypher aggregation query
- `evaluateSignificance()`: Check if pattern is statistically significant
  - Minimum sample size: 5 occurrences
  - Deviation threshold: 20% from baseline
- `generateInsight()`: Create human-readable insight

### 3. Create analytics queries
Create `apps/omnii_mcp/src/services/analytics/queries.ts`:
- Cypher query templates for each pattern type
- Parameterized by userId, timeRange
- Query patterns:
  - Meeting → Task creation correlation
  - Email thread → Meeting scheduling
  - Time-of-day productivity analysis
  - Collaboration frequency matrix

### 4. Create insight storage
Create `apps/omnii_mcp/src/services/analytics/insight-storage.ts`:
- Store detected patterns in Neo4j as Insight nodes
- Properties: type, insight text, confidence, timestamp, data
- Link to related entities (contacts, events, etc.)
- Mark as viewed/dismissed by user

### 5. Create analytics scheduler
Create `apps/omnii_mcp/src/services/analytics/analytics-scheduler.ts`:
- Daily job to run pattern detection
- Use BullMQ repeatable job
- Run during off-peak hours (3am user local time)
- Aggregate insights for weekly summary

### 6. Create analytics types
Create `apps/omnii_mcp/src/services/analytics/types.ts`:
- Pattern interface
- Insight interface with actionable recommendation
- AnalyticsSummary interface

## Acceptance Criteria
- [ ] System detects meeting → follow-up task patterns
- [ ] System identifies productivity windows
- [ ] Insights are actionable, not vanity metrics
- [ ] Insights stored and viewable

## Wave
3 (parallel with 10-04)
