# Omnii Neo4j Database

Railway Neo4j database deployment for the Omnii platform, following the [Railway Neo4j template](https://github.com/sukrutnrvd/neo4j-template) approach.

## ðŸš€ Features

- **Railway Neo4j Database**: Actual Neo4j database server deployment
- **CSV Import Support**: Bulk data import from CSV URLs
- **Auto-generated Password**: Railway generates secure passwords automatically
- **Internal TCP Address**: Railway provides internal networking
- **Logging Enabled**: Both user and server logs enabled
- **Multi-stage Build**: Optimized container with data preloading

## ðŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   omnii_mcp     â”‚    â”‚  Neo4j Database â”‚
â”‚   (Core API)    â”‚â”€â”€â”€â”€â”‚   (Port 7687)   â”‚
â”‚   Port 8000     â”‚    â”‚  Railway Deploy â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“‹ Prerequisites

- Railway account
- Docker (for local testing)

## ðŸš„ Railway Deployment

### 1. Deploy to Railway
```bash
# Connect to Railway
railway login

# Link to project
railway link

# Deploy the database
railway up
```

### 2. Get Connection Details
After deployment, Railway will provide:
- **TCP Address**: `neo4j://your-service.railway.internal:7687`
- **Generated Password**: Available in environment variables
- **Username**: Always `neo4j`

### 3. Connect from omnii_mcp
Update your `omnii_mcp` environment variables:
```bash
NEO4J_URI=neo4j://your-railway-neo4j-service.railway.internal:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=your-railway-generated-password
NEO4J_DATABASE=neo4j
```

## ðŸ“Š Environment Variables

### Railway Deployment
- `DB_PASSWORD`: Auto-generated by Railway
- `NODE_CSV_URLS`: Optional CSV URLs for bulk import (comma-separated)
- `RELATION_CSV_URLS`: Optional relationship CSV URLs (comma-separated)

### CSV Import Example
```bash
# Set in Railway dashboard
NODE_CSV_URLS=https://example.com/nodes.csv,https://example.com/more-nodes.csv
RELATION_CSV_URLS=https://example.com/relationships.csv
```

## ðŸ”§ CSV Import Format

### Node CSV Format
```csv
:ID,name:string,type:string,:LABEL
1,John Doe,person,Person
2,Acme Corp,company,Company
```

### Relationship CSV Format
```csv
:START_ID,:END_ID,:TYPE
1,2,WORKS_FOR
```

## ðŸ§ª Testing Connection

### From Local Development
```bash
# Test connection (replace with your Railway details)
docker run --rm neo4j:5.25.1 cypher-shell \
  -a neo4j://your-service.railway.internal:7687 \
  -u neo4j -p your-password \
  "RETURN 'Connected!' as status"
```

### From omnii_mcp
```bash
# Check Neo4j routes
curl "http://localhost:8000/api/neo4j/health"
curl "http://localhost:8000/api/neo4j/concepts?user_id=test&limit=5"
```

## ðŸ“Š Database Access

### Neo4j Browser (Local Testing Only)
- URL: `http://localhost:7474`
- Username: `neo4j`
- Password: Your Railway-generated password

### Cypher Queries
```cypher
// Check database status
CALL db.info();

// Count all nodes
MATCH (n) RETURN count(n);

// List node types
CALL db.labels();

// Sample concept query
MATCH (c:Concept) RETURN c LIMIT 5;
```

## ðŸ”„ Migration from External AuraDB

### 1. Export Data from AuraDB
```cypher
// Export nodes
MATCH (n) 
RETURN id(n) as id, labels(n) as labels, properties(n) as props;

// Export relationships  
MATCH (a)-[r]->(b)
RETURN id(a) as start, id(b) as end, type(r) as type, properties(r) as props;
```

### 2. Import to Railway Neo4j
- Convert to CSV format
- Upload to accessible URLs
- Set `NODE_CSV_URLS` and `RELATION_CSV_URLS` in Railway
- Redeploy

## ðŸš¨ Troubleshooting

### Connection Issues
- Verify Railway service is running
- Check TCP address in Railway dashboard
- Ensure password is correct
- Verify internal Railway networking

### Import Issues
- Check CSV URL accessibility
- Validate CSV format
- Review build logs in Railway
- Ensure proper headers in CSV files

### Performance Issues
- Monitor memory usage in Railway
- Check query performance
- Review logging output
- Consider upgrading Railway plan

## ðŸ“„ Files Structure

```
apps/omnii-neo4j/
â”œâ”€â”€ Dockerfile          # Multi-stage Neo4j build
â”œâ”€â”€ railway.toml        # Railway deployment config
â”œâ”€â”€ server-logs.xml     # Neo4j server logging config
â”œâ”€â”€ user-logs.xml       # Neo4j user logging config
â””â”€â”€ README.md          # This file
```

## ðŸ”— Integration

The `omnii_mcp` service connects directly to this Neo4j database using:
- Standard Neo4j driver (port 7687)
- Railway internal networking
- Existing Neo4j routes in `omnii_mcp/src/routes/neo4j.ts`

This replaces the need for external AuraDB and provides Railway-optimized Neo4j hosting.

## ðŸ“„ License

Part of the Omnii platform. 