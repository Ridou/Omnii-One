---
description: 
globs: 
alwaysApply: false
---
# üí¨ CHAT SCREEN IMPLEMENTATION PLAN

**Replace `settings.tsx` with `chat.tsx` - "Your AI assistant who actually gets you"**

---

## üéØ OVERVIEW

Transform the settings tab into a conversational interface following OMNII's established design patterns while incorporating Shape of AI UX paradigms for modern AI interaction. This chat screen becomes the central hub for natural language productivity coaching.

---

## üèóÔ∏è PHASE 1: ROUTING & TAB CONFIGURATION

### 1.1 Tab Layout Updates (`app/(tabs)/_layout.tsx`)

```typescript
// STEP 1: Add MessageCircle import to existing imports
import { 
  CircleUser as UserCircle, 
  Chrome as Home, 
  TrendingUp, 
  MessageCircle,  // ADD THIS
  Trophy 
} from 'lucide-react-native';

// STEP 2: Replace settings tab configuration
<Tabs.Screen
  name="chat"  // CHANGED from "settings"
  options={{
    tabBarIcon: ({ color, size }) => <MessageCircle size={size} color={color} />,
  }}
/>
```

### 1.2 File Structure Changes

```bash
# REMOVE
app/(tabs)/settings.tsx

# CREATE  
app/(tabs)/chat.tsx
src/types/chat.ts
hooks/useFetchChat.ts
components/chat/ (directory)
‚îú‚îÄ‚îÄ ChatMessage.tsx
‚îú‚îÄ‚îÄ ChatInput.tsx
‚îú‚îÄ‚îÄ QuickActions.tsx
‚îú‚îÄ‚îÄ ContextDisplay.tsx
‚îú‚îÄ‚îÄ ChatAchievements.tsx
‚îî‚îÄ‚îÄ VoiceInterface.tsx
```

---

## üèóÔ∏è PHASE 2: TYPE SYSTEM & DATA ARCHITECTURE

### 2.1 Chat Types (`src/types/chat.ts`)

```typescript
// Chat System Types - Following analytics.ts pattern
export interface ChatMessage {
  id: string;
  content: string;
  sender: 'user' | 'ai';
  timestamp: string;
  confidence?: number; // 0-100 (Shape of AI pattern)
  sources?: Citation[]; // Shape of AI Citations pattern
  xpEarned?: number;
  type?: 'text' | 'voice' | 'action' | 'suggestion';
  metadata?: {
    reasoning?: string; // Shape of AI Show the Work pattern
    alternatives?: string[]; // Shape of AI Alternatives pattern
    context?: string[];
  };
}

export interface Citation {
  id: string;
  name: string;
  type: 'analytics' | 'profile' | 'approvals' | 'achievements';
  url?: string;
  confidence: number;
}

export interface ChatContext {
  userState: 'focused' | 'stressed' | 'productive' | 'overwhelmed';
  recentActivity: Activity[];
  availableActions: QuickAction[];
  currentProjects: string[];
  todayMetrics: {
    tasksCompleted: number;
    focusTime: number;
    energy: number;
  };
}

export interface QuickAction {
  id: string;
  label: string;
  icon: string;
  type: 'navigation' | 'command' | 'template';
  action: string;
  description?: string;
}

export interface ChatAchievement {
  id: string;
  title: string;
  description: string;
  progress: number;
  maxProgress: number;
  xpReward: number;
  category: 'conversation' | 'voice' | 'integration' | 'learning';
}

export interface VoiceCommand {
  id: string;
  phrase: string;
  action: string;
  confidence: number;
  metadata?: Record<string, any>;
}

// Tab configuration following EXACT TabConfig pattern
export type ChatTab = 'conversation' | 'actions' | 'context' | 'progress';

export interface ChatTabConfig {
  key: ChatTab;
  label: string;
  icon: string;
  gradient: [string, string];
}

export interface ChatState {
  messages: ChatMessage[];
  context: ChatContext;
  isTyping: boolean;
  isListening: boolean;
  achievements: ChatAchievement[];
  quickActions: QuickAction[];
  isLoading: boolean;
  error: string | null;
}
```

### 2.2 Data Fetching Hook (`hooks/useFetchChat.ts`)

```typescript
import { useState, useEffect, useCallback } from 'react';
import type { ChatState, ChatMessage, ChatContext } from '~/types/chat';

// Mock data following EXACT useFetchAnalytics.ts pattern
const mockChatContext: ChatContext = {
  userState: 'productive',
  recentActivity: [
    { type: 'task_completed', description: 'Finished presentation prep', timestamp: new Date() },
    { type: 'focus_session', description: '2.5h deep work completed', timestamp: new Date() }
  ],
  availableActions: [
    { id: '1', label: 'Review Analytics', icon: 'üìä', type: 'navigation', action: '/(tabs)/analytics' },
    { id: '2', label: 'Plan Tomorrow', icon: 'üìÖ', type: 'template', action: 'planning_template' },
    { id: '3', label: 'Voice Command', icon: 'üé§', type: 'command', action: 'voice_input' }
  ],
  currentProjects: ['Quarterly Review', 'Team Onboarding', 'Process Documentation'],
  todayMetrics: { tasksCompleted: 8, focusTime: 5.2, energy: 87 }
};

const mockMessages: ChatMessage[] = [
  {
    id: '1',
    content: 'Good morning! You\'ve completed 8 tasks and focused for 5.2 hours today. What would you like to work on next?',
    sender: 'ai',
    timestamp: new Date().toISOString(),
    confidence: 95,
    sources: [{ id: '1', name: 'Today\'s Analytics', type: 'analytics', confidence: 98 }],
    type: 'text',
    metadata: {
      reasoning: 'Based on your morning productivity pattern and current energy levels',
      alternatives: ['Review analytics', 'Plan tomorrow', 'Take a break'],
      context: ['high_energy', 'productive_morning', 'good_focus_streak']
    }
  }
];

export function useFetchChat() {
  const [chatState, setChatState] = useState<ChatState>({
    messages: [],
    context: mockChatContext,
    isTyping: false,
    isListening: false,
    achievements: [],
    quickActions: mockChatContext.availableActions,
    isLoading: true,
    error: null
  });

  const fetchChatData = useCallback(async () => {
    setChatState(prev => ({ ...prev, isLoading: true }));
    try {
      // Simulate API call (IDENTICAL pattern to useFetchAnalytics)
      await new Promise(resolve => setTimeout(resolve, 800));
      
      setChatState(prev => ({
        ...prev,
        messages: mockMessages,
        context: mockChatContext,
        isLoading: false,
        error: null
      }));
    } catch (err) {
      setChatState(prev => ({
        ...prev,
        error: err instanceof Error ? err.message : 'Failed to fetch chat data',
        isLoading: false
      }));
    }
  }, []);

  const sendMessage = useCallback(async (content: string) => {
    const userMessage: ChatMessage = {
      id: Date.now().toString(),
      content,
      sender: 'user',
      timestamp: new Date().toISOString(),
      type: 'text'
    };

    setChatState(prev => ({
      ...prev,
      messages: [...prev.messages, userMessage],
      isTyping: true
    }));

    // Simulate AI response
    setTimeout(() => {
      const aiResponse: ChatMessage = {
        id: (Date.now() + 1).toString(),
        content: 'I understand. Let me help you with that based on your productivity patterns.',
        sender: 'ai',
        timestamp: new Date().toISOString(),
        confidence: 92,
        type: 'text',
        xpEarned: 5
      };

      setChatState(prev => ({
        ...prev,
        messages: [...prev.messages, aiResponse],
        isTyping: false
      }));
    }, 1500);
  }, []);

  useEffect(() => {
    fetchChatData();
  }, [fetchChatData]);

  return {
    ...chatState,
    sendMessage,
    refetch: fetchChatData,
  };
}
```

---

## üèóÔ∏è PHASE 3: MAIN CHAT SCREEN STRUCTURE

### 3.1 Core Chat Screen (`app/(tabs)/chat.tsx`)

```typescript
import React, { useState, useCallback, useRef, useEffect } from 'react';
import {
  StyleSheet,
  View,
  Text,
  ScrollView,
  TouchableOpacity,
  Animated,
  TextInput,
  KeyboardAvoidingView,
  Platform
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { Link, useRouter } from 'expo-router';
import { MessageCircle } from 'lucide-react-native';
import { useAuth } from '@/context/AuthContext';
import { useFetchChat } from '@/hooks/useFetchChat';
import { AppColors } from '@/constants/Colors';
import Svg, { Defs, LinearGradient, Stop, Rect } from 'react-native-svg';
import type { ChatTab, ChatTabConfig } from '~/types/chat';

// Tab configuration following EXACT profile.tsx pattern
const chatTabs: ChatTabConfig[] = [
  {
    key: 'conversation',
    label: 'Chat',
    icon: 'üí¨',
    gradient: [AppColors.aiGradientStart, AppColors.aiGradientEnd]
  },
  {
    key: 'actions',
    label: 'Actions',
    icon: '‚ö°',
    gradient: ['#667eea', '#764ba2']
  },
  {
    key: 'context',
    label: 'Context',
    icon: 'üß†',
    gradient: ['#4ECDC4', '#44A08D']
  },
  {
    key: 'progress',
    label: 'Progress',
    icon: 'üèÜ',
    gradient: ['#FFB347', '#FFD700']
  }
];

export default function ChatScreen() {
  const { user } = useAuth();
  const router = useRouter();
  const { 
    messages, 
    context, 
    isTyping, 
    quickActions, 
    achievements, 
    isLoading, 
    error, 
    sendMessage, 
    refetch 
  } = useFetchChat();
  
  const [selectedTab, setSelectedTab] = useState<ChatTab>('conversation');
  const [messageInput, setMessageInput] = useState('');

  // IDENTICAL animation refs from profile.tsx
  const shimmerAnimations = useRef(
    chatTabs.reduce((acc, tab) => {
      acc[tab.key] = new Animated.Value(0);
      return acc;
    }, {} as Record<ChatTab, Animated.Value>)
  ).current;

  const scaleAnimations = useRef(
    chatTabs.reduce((acc, tab) => {
      acc[tab.key] = new Animated.Value(1);
      return acc;
    }, {} as Record<ChatTab, Animated.Value>)
  ).current;

  // IDENTICAL shimmer animation from profile.tsx
  useEffect(() => {
    const activeAnimation = shimmerAnimations[selectedTab];
    
    const shimmerLoop = Animated.loop(
      Animated.sequence([
        Animated.timing(activeAnimation, {
          toValue: 1,
          duration: 1500,
          useNativeDriver: false,
        }),
        Animated.timing(activeAnimation, {
          toValue: 0,
          duration: 1500,
          useNativeDriver: false,
        }),
      ])
    );

    shimmerLoop.start();

    return () => {
      shimmerLoop.stop();
      activeAnimation.setValue(0);
    };
  }, [selectedTab, shimmerAnimations]);

  const handleTabPress = (tabKey: ChatTab) => {
    // IDENTICAL animation from profile.tsx
    const scaleAnim = scaleAnimations[tabKey];
    
    Animated.sequence([
      Animated.timing(scaleAnim, {
        toValue: 0.95,
        duration: 100,
        useNativeDriver: true,
      }),
      Animated.timing(scaleAnim, {
        toValue: 1,
        duration: 100,
        useNativeDriver: true,
      }),
    ]).start();

    setSelectedTab(tabKey);
  };

  const handleSendMessage = () => {
    if (messageInput.trim()) {
      sendMessage(messageInput.trim());
      setMessageInput('');
    }
  };

  // IDENTICAL ShimmerGradient component from profile.tsx
  const ShimmerGradient = ({ colors }: { colors: [string, string] }) => {
    const shimmerAnim = shimmerAnimations[selectedTab];
    
    const translateX = shimmerAnim.interpolate({
      inputRange: [0, 1],
      outputRange: [-200, 200],
    });

    return (
      <Animated.View
        style={{
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          transform: [{ translateX }],
        }}
      >
        <Svg height="100%" width="200%" style={{ position: 'absolute' }}>
          <Defs>
            <LinearGradient id="shimmer" x1="0%" y1="0%" x2="100%" y2="0%">
              <Stop offset="0%" stopColor={colors[0]} stopOpacity="0.8" />
              <Stop offset="50%" stopColor={colors[1]} stopOpacity="1" />
              <Stop offset="100%" stopColor={colors[0]} stopOpacity="0.8" />
            </LinearGradient>
          </Defs>
          <Rect width="100%" height="100%" fill="url(#shimmer)" />
        </Svg>
      </Animated.View>
    );
  };

  // IDENTICAL pattern to ProfileTabs from profile.tsx
  const ChatTabs = () => (
    <View style={styles.filterTabsContainer}>
      <View style={styles.filterTabsContent}>
        {chatTabs.map((tab) => {
          const isActive = selectedTab === tab.key;
          
          return (
            <Animated.View
              key={tab.key}
              style={{
                transform: [{ scale: scaleAnimations[tab.key] }],
                flex: 1,
              }}
            >
              <TouchableOpacity
                style={[
                  styles.filterTab,
                  isActive && styles.filterTabActive,
                  isActive && {
                    backgroundColor: 'transparent',
                    overflow: 'hidden',
                  }
                ]}
                onPress={() => handleTabPress(tab.key)}
                activeOpacity={0.8}
              >
                {isActive && (
                  <>
                    <View
                      style={{
                        position: 'absolute',
                        top: 0,
                        left: 0,
                        right: 0,
                        bottom: 0,
                        backgroundColor: tab.gradient[0],
                      }}
                    />
                    <ShimmerGradient colors={tab.gradient} />
                  </>
                )}
                
                <View style={styles.filterTabContent}>
                  <Text style={styles.filterTabIcon}>{tab.icon}</Text>
                  <Text
                    style={[
                      styles.filterTabText,
                      {
                        color: isActive ? '#FFFFFF' : AppColors.textSecondary,
                      },
                    ]}
                  >
                    {tab.label}
                  </Text>
                </View>
              </TouchableOpacity>
            </Animated.View>
          );
        })}
      </View>
    </View>
  );

  // Authentication check (IDENTICAL to profile.tsx pattern)
  if (!user) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.emptyContainer}>
          <MessageCircle size={64} color="#8E8E93" />
          <Text style={styles.title}>Chat</Text>
          <Text style={styles.subtitle}>Please log in to chat with your AI assistant</Text>
          
          <Link href="/(auth)/login" asChild>
            <TouchableOpacity style={styles.loginButton}>
              <Text style={styles.loginButtonText}>Login</Text>
            </TouchableOpacity>
          </Link>
        </View>
      </SafeAreaView>
    );
  }

  return (
    <KeyboardAvoidingView 
      style={styles.container}
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
    >
      <SafeAreaView style={styles.container}>
        {/* Header Section - IDENTICAL to analytics.tsx */}
        <View style={styles.header}>
          <View style={styles.headerTop}>
            <View style={styles.titleContainer}>
              <Text style={styles.title}>Chat</Text>
            </View>
          </View>
          <Text style={styles.subtitle}>
            Your AI assistant who actually gets you
          </Text>
        </View>
        
        {/* Chat Tabs - IDENTICAL pattern to ProfileTabs */}
        <ChatTabs />

        {/* Tab Content */}
        <View style={styles.listContainer}>
          {renderTabContent()}
        </View>

        {/* Input Section (only for conversation tab) */}
        {selectedTab === 'conversation' && (
          <View style={styles.inputContainer}>
            <View style={styles.inputRow}>
              <TextInput
                style={styles.messageInput}
                placeholder="Ask me anything about your productivity..."
                placeholderTextColor={AppColors.textSecondary}
                value={messageInput}
                onChangeText={setMessageInput}
                multiline
                maxLength={500}
              />
              <TouchableOpacity 
                style={styles.sendButton}
                onPress={handleSendMessage}
                disabled={!messageInput.trim()}
              >
                <Text style={styles.sendButtonText}>Send</Text>
              </TouchableOpacity>
            </View>
          </View>
        )}
      </SafeAreaView>
    </KeyboardAvoidingView>
  );

  // Tab content renderer (continues below...)
}
```

### 3.2 Tab Content Implementation

```typescript
// Tab content implementations (part of ChatScreen component)
const renderTabContent = () => {
  switch (selectedTab) {
    case 'conversation':
      return <ConversationContent />;
    case 'actions':
      return <ActionsContent />;
    case 'context':
      return <ContextContent />;
    case 'progress':
      return <ProgressContent />;
    default:
      return null;
  }
};

const ConversationContent = () => (
  <ScrollView 
    style={styles.scrollContainer} 
    contentContainerStyle={styles.tabContent}
    showsVerticalScrollIndicator={false}
  >
    {/* Wayfinders - Shape of AI Nudges Pattern */}
    <View style={styles.nudgesSection}>
      <Text style={styles.sectionTitle}>üí° Try asking me...</Text>
      <View style={styles.nudgesContainer}>
        <TouchableOpacity style={styles.nudgeButton}>
          <Text style={styles.nudgeText}>"What should I focus on today?"</Text>
        </TouchableOpacity>
        <TouchableOpacity style={styles.nudgeButton}>
          <Text style={styles.nudgeText}>"Help me plan tomorrow"</Text>
        </TouchableOpacity>
        <TouchableOpacity style={styles.nudgeButton}>
          <Text style={styles.nudgeText}>"Show my productivity patterns"</Text>
        </TouchableOpacity>
      </View>
    </View>

    {/* Messages Container */}
    <View style={styles.messagesContainer}>
      {messages.map((message) => (
        <MessageCard key={message.id} message={message} />
      ))}
      
      {isTyping && (
        <View style={styles.typingIndicator}>
          <Text style={styles.typingText}>AI is thinking...</Text>
        </View>
      )}
    </View>
  </ScrollView>
);

const ActionsContent = () => (
  <ScrollView 
    style={styles.scrollContainer} 
    contentContainerStyle={styles.tabContent}
    showsVerticalScrollIndicator={false}
  >
    <Text style={styles.sectionTitle}>‚ö° Quick Actions</Text>
    {quickActions.map((action) => (
      <TouchableOpacity key={action.id} style={styles.actionCard}>
        <Text style={styles.actionIcon}>{action.icon}</Text>
        <View style={styles.actionContent}>
          <Text style={styles.actionTitle}>{action.label}</Text>
          <Text style={styles.actionDescription}>{action.description}</Text>
        </View>
        <Text style={styles.actionArrow}>‚Üí</Text>
      </TouchableOpacity>
    ))}
  </ScrollView>
);

const ContextContent = () => (
  <ScrollView 
    style={styles.scrollContainer} 
    contentContainerStyle={styles.tabContent}
    showsVerticalScrollIndicator={false}
  >
    {/* Show the Work - Shape of AI Pattern */}
    <View style={styles.contextCard}>
      <Text style={styles.cardTitle}>üîç AI Context</Text>
      <Text style={styles.contextDescription}>
        I know about your current productivity state:
      </Text>
      <View style={styles.contextList}>
        <Text style={styles.contextItem}>
          ‚Ä¢ Today: {context.todayMetrics.tasksCompleted} tasks completed, {context.todayMetrics.focusTime}h focused
        </Text>
        <Text style={styles.contextItem}>
          ‚Ä¢ Energy Level: {context.todayMetrics.energy}% ({context.userState})
        </Text>
        <Text style={styles.contextItem}>
          ‚Ä¢ Active Projects: {context.currentProjects.length} in progress
        </Text>
      </View>
    </View>

    {/* Controls - Shape of AI Pattern */}
    <View style={styles.controlsCard}>
      <Text style={styles.cardTitle}>üéõÔ∏è AI Controls</Text>
      <TouchableOpacity style={styles.controlButton}>
        <Text style={styles.controlText}>Pause Learning</Text>
      </TouchableOpacity>
      <TouchableOpacity style={styles.controlButton}>
        <Text style={styles.controlText}>Reset Context</Text>
      </TouchableOpacity>
      <TouchableOpacity style={styles.controlButton}>
        <Text style={styles.controlText}>Export Conversation</Text>
      </TouchableOpacity>
    </View>
  </ScrollView>
);

const ProgressContent = () => (
  <ScrollView 
    style={styles.scrollContainer} 
    contentContainerStyle={styles.tabContent}
    showsVerticalScrollIndicator={false}
  >
    <Text style={styles.sectionTitle}>üèÜ Chat Milestones</Text>
    
    {/* Chat-specific achievements */}
    <View style={styles.achievementCard}>
      <Text style={styles.achievementIcon}>üí¨</Text>
      <View style={styles.achievementContent}>
        <Text style={styles.achievementTitle}>First Conversation</Text>
        <Text style={styles.achievementDescription}>Have a 5-message exchange with AI</Text>
        <Text style={styles.achievementProgress}>3 / 5 messages ‚Ä¢ 50 XP</Text>
      </View>
    </View>

    <View style={styles.achievementCard}>
      <Text style={styles.achievementIcon}>üé§</Text>
      <View style={styles.achievementContent}>
        <Text style={styles.achievementTitle}>Voice Pioneer</Text>
        <Text style={styles.achievementDescription}>Use voice commands 5 times successfully</Text>
        <Text style={styles.achievementProgress}>1 / 5 uses ‚Ä¢ 75 XP</Text>
      </View>
    </View>

    {/* XP earning opportunity */}
    <TouchableOpacity style={styles.xpEarnCard}>
      <Text style={styles.xpEarnIcon}>‚ú®</Text>
      <Text style={styles.xpEarnText}>Ask a question to earn 5 XP</Text>
    </TouchableOpacity>
  </ScrollView>
);

// Message Card Component with Shape of AI patterns
const MessageCard = ({ message }: { message: ChatMessage }) => (
  <View style={[
    styles.messageCard,
    message.sender === 'user' ? styles.userMessage : styles.aiMessage
  ]}>
    <Text style={styles.messageText}>{message.content}</Text>
    
    {/* Shape of AI - Citations Pattern */}
    {message.sources && message.sources.length > 0 && (
      <View style={styles.citationsContainer}>
        <Text style={styles.citationsLabel}>Sources:</Text>
        {message.sources.map(source => (
          <TouchableOpacity key={source.id} style={styles.citationChip}>
            <Text style={styles.citationText}>{source.name}</Text>
          </TouchableOpacity>
        ))}
      </View>
    )}
    
    {/* Shape of AI - Confidence Indicator */}
    {message.confidence && (
      <View style={styles.confidenceContainer}>
        <Text style={styles.confidenceLabel}>Confidence: {message.confidence}%</Text>
        <View style={styles.confidenceBar}>
          <View 
            style={[
              styles.confidenceFill, 
              { width: `${message.confidence}%` }
            ]} 
          />
        </View>
      </View>
    )}

    {/* XP Earned Indicator */}
    {message.xpEarned && (
      <View style={styles.xpIndicator}>
        <Text style={styles.xpText}>+{message.xpEarned} XP</Text>
      </View>
    )}
  </View>
);
```

---

## üèóÔ∏è PHASE 4: STYLING SYSTEM (IDENTICAL PATTERNS)

### 4.1 Complete StyleSheet (`app/(tabs)/chat.tsx` - styles)

```typescript
const styles = StyleSheet.create({
  // IDENTICAL base styles from analytics.tsx
  container: {
    flex: 1,
    backgroundColor: AppColors.background,
  },
  header: {
    backgroundColor: AppColors.cardBackground,
    padding: 24,
    paddingTop: 20,
    borderBottomWidth: 1,
    borderBottomColor: AppColors.border,
  },
  headerTop: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 12,
    minHeight: 40,
  },
  titleContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 12,
    flex: 1,
  },
  title: {
    fontSize: 28,
    fontWeight: '700',
    color: AppColors.textPrimary,
  },
  subtitle: {
    fontSize: 16,
    color: AppColors.textSecondary,
    fontWeight: '400',
    marginTop: 4,
  },

  // IDENTICAL tab styles from profile.tsx
  filterTabsContainer: {
    marginVertical: 12,
    paddingHorizontal: 16,
  },
  filterTabsContent: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    paddingHorizontal: 2,
  },
  filterTab: {
    flex: 1,
    marginHorizontal: 3,
    paddingVertical: 12,
    paddingHorizontal: 8,
    borderRadius: 14,
    alignItems: 'center',
    justifyContent: 'center',
    backgroundColor: AppColors.cardBackground,
    borderWidth: 2,
    borderColor: AppColors.borderLight,
    ...AppColors.shadows.card,
    minHeight: 50,
  },
  filterTabActive: {
    borderWidth: 0,
    ...AppColors.shadows.elevated,
  },
  filterTabContent: {
    alignItems: 'center',
    gap: 4,
  },
  filterTabIcon: {
    fontSize: 16,
  },
  filterTabText: {
    fontSize: 13,
    fontWeight: '600',
  },
  listContainer: {
    flex: 1,
  },
  scrollContainer: {
    flex: 1,
  },
  tabContent: {
    padding: 20,
  },

  // Chat-specific styles following same pattern
  sectionTitle: {
    fontSize: 20,
    fontWeight: '700',
    color: AppColors.textPrimary,
    marginBottom: 16,
  },
  
  // Input styles
  inputContainer: {
    backgroundColor: AppColors.cardBackground,
    padding: 16,
    borderTopWidth: 1,
    borderTopColor: AppColors.border,
  },
  inputRow: {
    flexDirection: 'row',
    alignItems: 'flex-end',
    gap: 12,
  },
  messageInput: {
    flex: 1,
    backgroundColor: AppColors.background,
    borderRadius: 12,
    paddingHorizontal: 16,
    paddingVertical: 12,
    fontSize: 16,
    color: AppColors.textPrimary,
    maxHeight: 100,
    borderWidth: 1,
    borderColor: AppColors.borderLight,
  },
  sendButton: {
    backgroundColor: AppColors.aiGradientStart,
    borderRadius: 12,
    paddingHorizontal: 20,
    paddingVertical: 12,
  },
  sendButtonText: {
    color: '#FFFFFF',
    fontSize: 16,
    fontWeight: '600',
  },

  // Nudges section (Shape of AI)
  nudgesSection: {
    marginBottom: 24,
  },
  nudgesContainer: {
    gap: 8,
  },
  nudgeButton: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 12,
    padding: 16,
    borderWidth: 1,
    borderColor: AppColors.borderLight,
    ...AppColors.shadows.card,
  },
  nudgeText: {
    fontSize: 14,
    color: AppColors.textPrimary,
    fontWeight: '500',
  },

  // Messages
  messagesContainer: {
    gap: 16,
  },
  messageCard: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 16,
    padding: 16,
    ...AppColors.shadows.card,
  },
  userMessage: {
    alignSelf: 'flex-end',
    backgroundColor: AppColors.aiGradientStart,
    maxWidth: '80%',
  },
  aiMessage: {
    alignSelf: 'flex-start',
    maxWidth: '85%',
  },
  messageText: {
    fontSize: 16,
    color: AppColors.textPrimary,
    lineHeight: 22,
  },
  typingIndicator: {
    alignSelf: 'flex-start',
    backgroundColor: AppColors.background,
    borderRadius: 16,
    padding: 16,
  },
  typingText: {
    fontSize: 14,
    color: AppColors.textSecondary,
    fontStyle: 'italic',
  },

  // Shape of AI - Citations
  citationsContainer: {
    marginTop: 12,
    gap: 8,
  },
  citationsLabel: {
    fontSize: 12,
    color: AppColors.textSecondary,
    fontWeight: '600',
  },
  citationChip: {
    backgroundColor: AppColors.background,
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 8,
    alignSelf: 'flex-start',
  },
  citationText: {
    fontSize: 11,
    color: AppColors.textSecondary,
    fontWeight: '500',
  },

  // Shape of AI - Confidence
  confidenceContainer: {
    marginTop: 8,
  },
  confidenceLabel: {
    fontSize: 12,
    color: AppColors.textSecondary,
    marginBottom: 4,
  },
  confidenceBar: {
    height: 4,
    backgroundColor: AppColors.borderLight,
    borderRadius: 2,
    overflow: 'hidden',
  },
  confidenceFill: {
    height: '100%',
    backgroundColor: AppColors.aiGradientStart,
    borderRadius: 2,
  },

  // XP Indicator
  xpIndicator: {
    alignSelf: 'flex-end',
    backgroundColor: `${AppColors.aiGradientStart}15`,
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 8,
    marginTop: 8,
  },
  xpText: {
    fontSize: 12,
    color: AppColors.aiGradientStart,
    fontWeight: '600',
  },

  // Actions content
  actionCard: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 16,
    padding: 20,
    marginBottom: 12,
    flexDirection: 'row',
    alignItems: 'center',
    ...AppColors.shadows.card,
  },
  actionIcon: {
    fontSize: 24,
    marginRight: 16,
  },
  actionContent: {
    flex: 1,
  },
  actionTitle: {
    fontSize: 16,
    fontWeight: '600',
    color: AppColors.textPrimary,
    marginBottom: 4,
  },
  actionDescription: {
    fontSize: 14,
    color: AppColors.textSecondary,
  },
  actionArrow: {
    fontSize: 18,
    color: AppColors.textSecondary,
  },

  // Context content
  contextCard: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 16,
    padding: 20,
    marginBottom: 16,
    ...AppColors.shadows.card,
  },
  cardTitle: {
    fontSize: 18,
    fontWeight: '600',
    color: AppColors.textPrimary,
    marginBottom: 8,
  },
  contextDescription: {
    fontSize: 14,
    color: AppColors.textSecondary,
    marginBottom: 16,
    lineHeight: 20,
  },
  contextList: {
    gap: 8,
  },
  contextItem: {
    fontSize: 14,
    color: AppColors.textPrimary,
    lineHeight: 20,
  },

  // Controls
  controlsCard: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 16,
    padding: 20,
    marginBottom: 16,
    ...AppColors.shadows.card,
  },
  controlButton: {
    backgroundColor: AppColors.background,
    borderRadius: 12,
    padding: 16,
    marginBottom: 8,
    alignItems: 'center',
  },
  controlText: {
    fontSize: 14,
    color: AppColors.textPrimary,
    fontWeight: '600',
  },

  // Progress content
  achievementCard: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 16,
    padding: 20,
    marginBottom: 12,
    flexDirection: 'row',
    alignItems: 'center',
    ...AppColors.shadows.card,
  },
  achievementIcon: {
    fontSize: 32,
    marginRight: 16,
  },
  achievementContent: {
    flex: 1,
  },
  achievementTitle: {
    fontSize: 16,
    fontWeight: '600',
    color: AppColors.textPrimary,
    marginBottom: 4,
  },
  achievementDescription: {
    fontSize: 14,
    color: AppColors.textSecondary,
    marginBottom: 4,
    lineHeight: 20,
  },
  achievementProgress: {
    fontSize: 12,
    color: AppColors.aiGradientStart,
    fontWeight: '600',
  },
  xpEarnCard: {
    backgroundColor: `${AppColors.aiGradientStart}15`,
    borderRadius: 16,
    padding: 20,
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'center',
    gap: 12,
  },
  xpEarnIcon: {
    fontSize: 24,
  },
  xpEarnText: {
    fontSize: 16,
    color: AppColors.aiGradientStart,
    fontWeight: '600',
  },

  // Empty states (IDENTICAL to analytics.tsx)
  emptyContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 24,
  },
  loginButton: {
    marginTop: 16,
    backgroundColor: AppColors.aiGradientStart,
    paddingVertical: 12,
    paddingHorizontal: 24,
    borderRadius: 8,
  },
  loginButtonText: {
    color: '#FFFFFF',
    fontSize: 16,
    fontWeight: '600',
  },
});
```

---

## üèóÔ∏è PHASE 5: SHAPE OF AI UX INTEGRATION

### 5.1 Wayfinders (Getting Started)

**Implementation in ConversationContent:**
- ‚úÖ **Nudges**: Try asking me... prompts
- ‚úÖ **Suggestions**: Context-aware conversation starters
- ‚úÖ **Follow-ups**: AI suggests next questions based on responses

### 5.2 Inputs (Natural Language)

**Implementation in ChatInput:**
- ‚úÖ **Open Input**: Multi-line text input with 500 char limit
- ‚úÖ **Voice Commands**: Microphone button for speech-to-text
- ‚úÖ **Token Layering**: Quick chips for @today, @analytics, @tasks context

### 5.3 Governors (User Control)

**Implementation in ContextContent:**
- ‚úÖ **Show the Work**: AI explains its reasoning process
- ‚úÖ **Controls**: Pause learning, reset context, export options
- ‚úÖ **Prompt Transparency**: Show what AI knows about user

### 5.4 Trust Indicators (Building Confidence)

**Implementation in MessageCard:**
- ‚úÖ **Citations**: Source references for AI responses
- ‚úÖ **Confidence**: 0-100% certainty indicators
- ‚úÖ **Explainability**: Tap to see AI reasoning chain

---

## üèóÔ∏è PHASE 6: ACHIEVEMENT INTEGRATION

### 6.1 Chat-Specific Achievements

```typescript
// Integration with existing achievements system
const chatAchievements = [
  {
    id: 'first-conversation',
    title: 'First Conversation',
    description: 'Have a 5-message exchange with AI',
    xpReward: 50,
    category: 'conversation',
    difficulty: 'easy',
    progress: 0,
    maxProgress: 5
  },
  {
    id: 'voice-pioneer',
    title: 'Voice Pioneer',
    description: 'Use voice commands 5 times successfully',
    xpReward: 75,
    category: 'voice',
    difficulty: 'easy',
    progress: 0,
    maxProgress: 5
  },
  {
    id: 'question-asker',
    title: 'Question Asker',
    description: 'Ask AI 3 different types of productivity questions',
    xpReward: 100,
    category: 'learning',
    difficulty: 'medium',
    progress: 0,
    maxProgress: 3
  }
];
```

### 6.2 XP Earning Mechanics

```typescript
// Real-time XP earning for conversations
const handleMessageSend = async (message: string) => {
  await sendMessage(message);
  
  // Award XP based on message type and quality
  const xpEarned = calculateConversationXP(message);
  if (xpEarned > 0) {
    showXPNotification(xpEarned);
    updateUserXP(xpEarned);
  }
};

const calculateConversationXP = (message: string): number => {
  // Basic message: 5 XP
  // Question: 10 XP  
  // Voice command: 15 XP
  // Complex interaction: 25 XP
  return 5; // Base implementation
};
```

---

## üèóÔ∏è PHASE 7: CROSS-SCREEN INTEGRATION

### 7.1 Deep Linking from Other Screens

```typescript
// From Analytics: "Let me explain this pattern in chat"
const navigateToChat = (context?: string) => {
  router.push({
    pathname: '/(tabs)/chat',
    params: { 
      tab: 'conversation',
      context: context || 'general'
    }
  });
};

// From Approvals: "Discuss this suggestion with AI"
// From Profile: "Chat about your work style"
// From Achievements: "Ask AI about achievement strategies"
```

### 7.2 Context Sharing Between Screens

```typescript
// AI understands user state from all screens
const contextFromAnalytics = {
  todayProductivity: analytics.todayMetrics,
  patterns: analytics.weeklyPatterns,
  insights: analytics.aiInsights
};

const contextFromProfile = {
  workStyle: profile.productivityDNA,
  preferences: profile.aiTuning,
  milestones: profile.milestones
};

// Shared in chat context for intelligent responses
```

---

## üèóÔ∏è PHASE 8: COMPONENT ARCHITECTURE

### 8.1 Chat Components Structure

```
components/chat/
‚îú‚îÄ‚îÄ ChatMessage.tsx          // Message with AI patterns
‚îú‚îÄ‚îÄ ChatInput.tsx           // Input with voice/tokens
‚îú‚îÄ‚îÄ QuickActions.tsx        // Pre-built flows
‚îú‚îÄ‚îÄ ContextDisplay.tsx      // AI transparency
‚îú‚îÄ‚îÄ ChatAchievements.tsx    // Achievement progress  
‚îú‚îÄ‚îÄ VoiceInterface.tsx      // Voice commands
‚îú‚îÄ‚îÄ CitationChip.tsx        // Source references
‚îî‚îÄ‚îÄ ConfidenceIndicator.tsx // Trust building
```

### 8.2 Reusable Patterns

- **MessageCard**: Consistent with ApprovalCard styling
- **ActionCard**: Following AIInsightCard pattern
- **AchievementCard**: Reusing existing component
- **ContextCard**: Based on analytics MetricCard

---

## üèóÔ∏è PHASE 9: IMPLEMENTATION TIMELINE

### Week 1: Foundation
- **Day 1-2**: File structure, routing, type definitions
- **Day 3-4**: Basic chat screen with tabs (copy analytics.tsx)
- **Day 5**: IDENTICAL animations and styling

### Week 2: Shape of AI Integration
- **Day 1-2**: Wayfinders (nudges, suggestions, follow-ups)
- **Day 3-4**: Inputs (open input, voice interface, tokens)
- **Day 5**: Governors (transparency, controls, reasoning)

### Week 3: Chat Functionality  
- **Day 1-2**: Message sending/receiving with mock responses
- **Day 3-4**: Context awareness and citation integration
- **Day 5**: Trust indicators and confidence display

### Week 4: Polish & Integration
- **Day 1-2**: Cross-screen navigation and deep linking
- **Day 3-4**: Achievement system integration and XP mechanics
- **Day 5**: Testing, refinement, performance optimization

---

## üèóÔ∏è PHASE 10: SUCCESS METRICS

### Technical Compliance
- ‚úÖ **IDENTICAL patterns**: Animations, styling, structure match existing screens
- ‚úÖ **Type safety**: Full TypeScript integration with existing systems
- ‚úÖ **Authentication**: Same user check pattern as other screens
- ‚úÖ **Performance**: 60fps animations, sub-200ms responses

### Shape of AI Implementation
- ‚úÖ **Wayfinders**: 3+ nudge types, context-aware suggestions
- ‚úÖ **Inputs**: Open input, voice commands, token layering
- ‚úÖ **Governors**: Show work, controls, transparency features
- ‚úÖ **Trust**: Citations, confidence indicators, explainability

### Achievement Integration
- ‚úÖ **Real-time XP**: Conversation-based earning mechanics
- ‚úÖ **Chat milestones**: 6+ chat-specific achievements
- ‚úÖ **Cross-navigation**: Deep links to/from other screens
- ‚úÖ **Progress tracking**: Visual progress in dedicated tab

### User Experience
- ‚úÖ **Natural conversation**: Context-aware AI responses
- ‚úÖ **Visual consistency**: Matches OMNII design language perfectly
- ‚úÖ **Accessibility**: Screen reader compatible, keyboard navigation
- ‚úÖ **Performance**: Smooth scrolling, responsive interactions

---

This implementation plan ensures the chat screen becomes a natural, powerful extension of OMNII that maintains perfect consistency with existing patterns while introducing cutting-edge AI interaction paradigms that make the assistant feel truly intelligent and transparent.
