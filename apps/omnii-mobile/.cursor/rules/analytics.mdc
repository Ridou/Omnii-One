---
description: 
globs: 
alwaysApply: false
---
# üìä ANALYTICS SCREEN IMPLEMENTATION PLAN

## üéØ Overview
Transform `app/(tabs)/history.tsx` into a comprehensive `analytics.tsx` screen following exact patterns from `profile.tsx` and `approvals.tsx`. Implements "Your productivity scientist" concept from screens.mdc with modern AI UX paradigms.

## üìã Current State Analysis

### What We're Replacing
- **File**: `app/(tabs)/history.tsx` ‚Üí `app/(tabs)/analytics.tsx`
- **Tab Icon**: `ClockHistory` ‚Üí `TrendingUp` (from lucide-react-native)
- **Function**: Simple approval history ‚Üí Comprehensive productivity analytics
- **Design**: Basic styling ‚Üí Modern AI-powered dashboard with animated tabs

### Codebase Pattern Analysis ‚úÖ
Based on actual analysis of `profile.tsx` and `approvals.tsx`:
- ‚úÖ **Identical Header Structure**: 28px title, 16px subtitle, action area
- ‚úÖ **4-Tab Animated System**: Shimmer gradients, scale animations, identical to profile
- ‚úÖ **AppColors Integration**: Same color system, gradients, shadows
- ‚úÖ **ScrollView Content**: Vertical scrolling with 20px padding
- ‚úÖ **Authentication Pattern**: Login redirect using `useAuth` hook
- ‚úÖ **TypeScript Patterns**: Following existing type structures

## üîß STEP 1: File Structure & Routing

### 1.1 Tab Layout Update
**File**: `app/(tabs)/_layout.tsx`

```typescript
// UPDATE: Line 3 - Import change
import { CircleUser as UserCircle, Chrome as Home, TrendingUp, Settings } from 'lucide-react-native';

// UPDATE: Line 47-51 - Tab screen configuration
<Tabs.Screen
  name="analytics"  // Changed from "history"
  options={{
    tabBarIcon: ({ color, size }) => <TrendingUp size={size} color={color} />,
  }}
/>
```

### 1.2 File Migration Process
1. **Backup**: `cp app/(tabs)/history.tsx app/(tabs)/history.backup.tsx`
2. **Rename**: `mv app/(tabs)/history.tsx app/(tabs)/analytics.tsx`
3. **Update Internal References**: Search codebase for `/history` links ‚Üí `/analytics`

## üèóÔ∏è STEP 2: Type System (Following Profile Pattern)

### 2.1 Analytics Types
**File**: `src/types/analytics.ts` (new file)

```typescript
// Analytics System Types - Following profile.ts pattern

export interface AnalyticsData {
  todayMetrics: TodayMetrics;
  energyCurve: EnergyDataPoint[];
  focusStreaks: FocusStreak[];
  weeklyPatterns: WeeklyPattern[];
  aiInsights: AIInsight[];
  predictions: Prediction[];
  bottlenecks: BottleneckAnalysis[];
  distractions: DistractionData[];
}

export interface TodayMetrics {
  tasksCompleted: number;
  hoursFocused: number;
  xpEarned: number;
  efficiencyScore: number; // 0-100 AI-calculated
  currentStreak: number;
  bestStreak: number;
}

export interface EnergyDataPoint {
  hour: number; // 0-23
  energy: number; // 0-100
  productivity: number; // 0-100
  focusQuality: number; // 0-100
}

export interface AIInsight {
  id: string;
  type: 'pattern' | 'suggestion' | 'prediction' | 'bottleneck';
  title: string;
  message: string;
  confidence: number; // 0-100
  action?: string;
  impact?: 'low' | 'medium' | 'high';
  sources: string[];
  suggestions?: string[];
  dismissed?: boolean;
}

export interface WeeklyPattern {
  day: string;
  productivity: number;
  energy: number;
  focus: number;
  taskCompletion: number;
}

export interface BottleneckAnalysis {
  category: string;
  impact: number; // hours lost per week
  frequency: number; // occurrences per week
  aiSuggestion: string;
  actionable: boolean;
}

export type AnalyticsTab = 'dashboard' | 'insights' | 'trends' | 'reports';

export interface AnalyticsTabConfig {
  key: AnalyticsTab;
  label: string;
  icon: string;
  gradient: [string, string];
}
```

### 2.2 Data Fetching Hook
**File**: `hooks/useFetchAnalytics.ts` (following `useFetchApprovals.ts` pattern)

```typescript
import { useState, useEffect } from 'react';
import type { AnalyticsData } from '~/types/analytics';

// Mock data following exact pattern from useFetchApprovals.ts
const mockAnalyticsData: AnalyticsData = {
  todayMetrics: {
    tasksCompleted: 8,
    hoursFocused: 5.2,
    xpEarned: 340,
    efficiencyScore: 87,
    currentStreak: 120,
    bestStreak: 180
  },
  energyCurve: [
    { hour: 6, energy: 20, productivity: 15, focusQuality: 10 },
    { hour: 7, energy: 40, productivity: 35, focusQuality: 30 },
    { hour: 8, energy: 65, productivity: 70, focusQuality: 75 },
    { hour: 9, energy: 95, productivity: 98, focusQuality: 95 },
    { hour: 10, energy: 98, productivity: 95, focusQuality: 90 },
    // ... 24 data points
  ],
  aiInsights: [
    {
      id: '1',
      type: 'pattern',
      title: 'üìÖ Weekly Pattern Detected',
      message: "You're 40% more focused on Tuesdays - should we block more deep work then?",
      confidence: 92,
      action: 'Schedule Deep Work',
      impact: 'high',
      sources: ['Calendar data', 'Task completion', 'Energy tracking']
    }
    // ... more insights
  ]
  // ... rest of mock data
};

export function useFetchAnalytics() {
  const [analytics, setAnalytics] = useState<AnalyticsData | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const fetchAnalytics = async () => {
    setIsLoading(true);
    try {
      // Simulate API call (identical pattern to useFetchApprovals)
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      setAnalytics(mockAnalyticsData);
      setError(null);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to fetch analytics');
      console.error('Error fetching analytics:', err);
    } finally {
      setIsLoading(false);
    }
  };

  useEffect(() => {
    fetchAnalytics();
  }, []);

  return {
    analytics,
    isLoading,
    error,
    refetch: fetchAnalytics,
  };
}
```

## üèóÔ∏è STEP 3: Main Analytics Screen Structure

### 3.1 Tab Configuration (Exact Profile.tsx Pattern)
**File**: `app/(tabs)/analytics.tsx`

```typescript
import React, { useState, useCallback, useRef, useEffect } from 'react';
import {
  StyleSheet,
  View,
  Text,
  RefreshControl,
  TouchableOpacity,
  Animated,
  Dimensions,
  ScrollView
} from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { Link, useRouter } from 'expo-router';
import { TrendingUp } from 'lucide-react-native';
import { useAuth } from '@/context/AuthContext';
import { useFetchAnalytics } from '@/hooks/useFetchAnalytics';
import { AppColors } from '@/constants/Colors';
import Svg, { Defs, LinearGradient, Stop, Rect } from 'react-native-svg';
import type { AnalyticsTab, AnalyticsTabConfig } from '~/types/analytics';

const { width: screenWidth } = Dimensions.get('window');

// Tab configuration following EXACT profile.tsx pattern
const analyticsTabs: AnalyticsTabConfig[] = [
  {
    key: 'dashboard',
    label: 'Today',
    icon: 'üìä',
    gradient: [AppColors.aiGradientStart, AppColors.aiGradientEnd]
  },
  {
    key: 'insights',
    label: 'AI Insights',
    icon: 'üß†',
    gradient: ['#667eea', '#764ba2']
  },
  {
    key: 'trends',
    label: 'Trends',
    icon: 'üìà',
    gradient: ['#4ECDC4', '#44A08D']
  },
  {
    key: 'reports',
    label: 'Reports',
    icon: 'üìã',
    gradient: ['#FFB347', '#FFD700']
  }
];

export default function AnalyticsScreen() {
  const { user } = useAuth();
  const { analytics, isLoading, refetch } = useFetchAnalytics();
  const router = useRouter();
  
  const [selectedTab, setSelectedTab] = useState<AnalyticsTab>('dashboard');
  const [refreshing, setRefreshing] = useState(false);

  // IDENTICAL animation refs from profile.tsx
  const shimmerAnimations = useRef(
    analyticsTabs.reduce((acc, tab) => {
      acc[tab.key] = new Animated.Value(0);
      return acc;
    }, {} as Record<AnalyticsTab, Animated.Value>)
  ).current;

  const scaleAnimations = useRef(
    analyticsTabs.reduce((acc, tab) => {
      acc[tab.key] = new Animated.Value(1);
      return acc;
    }, {} as Record<AnalyticsTab, Animated.Value>)
  ).current;

  // IDENTICAL shimmer animation from profile.tsx
  useEffect(() => {
    const activeAnimation = shimmerAnimations[selectedTab];
    
    const shimmerLoop = Animated.loop(
      Animated.sequence([
        Animated.timing(activeAnimation, {
          toValue: 1,
          duration: 1500,
          useNativeDriver: false,
        }),
        Animated.timing(activeAnimation, {
          toValue: 0,
          duration: 1500,
          useNativeDriver: false,
        }),
      ])
    );

    shimmerLoop.start();

    return () => {
      shimmerLoop.stop();
      activeAnimation.setValue(0);
    };
  }, [selectedTab, shimmerAnimations]);

  const onRefresh = useCallback(async () => {
    setRefreshing(true);
    await refetch();
    setRefreshing(false);
  }, [refetch]);

  const handleTabPress = (tabKey: AnalyticsTab) => {
    // IDENTICAL animation from profile.tsx
    const scaleAnim = scaleAnimations[tabKey];
    
    Animated.sequence([
      Animated.timing(scaleAnim, {
        toValue: 0.95,
        duration: 100,
        useNativeDriver: true,
      }),
      Animated.timing(scaleAnim, {
        toValue: 1,
        duration: 100,
        useNativeDriver: true,
      }),
    ]).start();

    setSelectedTab(tabKey);
  };

  // IDENTICAL ShimmerGradient component from profile.tsx
  const ShimmerGradient = ({ colors }: { colors: [string, string] }) => {
    const shimmerAnim = shimmerAnimations[selectedTab];
    
    const translateX = shimmerAnim.interpolate({
      inputRange: [0, 1],
      outputRange: [-200, 200],
    });

    return (
      <Animated.View
        style={{
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          transform: [{ translateX }],
        }}
      >
        <Svg height="100%" width="200%" style={{ position: 'absolute' }}>
          <Defs>
            <LinearGradient id="shimmer" x1="0%" y1="0%" x2="100%" y2="0%">
              <Stop offset="0%" stopColor={colors[0]} stopOpacity="0.8" />
              <Stop offset="50%" stopColor={colors[1]} stopOpacity="1" />
              <Stop offset="100%" stopColor={colors[0]} stopOpacity="0.8" />
            </LinearGradient>
          </Defs>
          <Rect width="100%" height="100%" fill="url(#shimmer)" />
        </Svg>
      </Animated.View>
    );
  };
```

### 3.2 Analytics Tabs Component (Exact Profile Pattern)
```typescript
  // IDENTICAL pattern to ProfileTabs from profile.tsx
  const AnalyticsTabs = () => (
    <View style={styles.filterTabsContainer}>
      <View style={styles.filterTabsContent}>
        {analyticsTabs.map((tab) => {
          const isActive = selectedTab === tab.key;
          
          return (
            <Animated.View
              key={tab.key}
              style={{
                transform: [{ scale: scaleAnimations[tab.key] }],
                flex: 1,
              }}
            >
              <TouchableOpacity
                style={[
                  styles.filterTab,
                  isActive && styles.filterTabActive,
                  isActive && {
                    backgroundColor: 'transparent',
                    overflow: 'hidden',
                  }
                ]}
                onPress={() => handleTabPress(tab.key)}
                activeOpacity={0.8}
              >
                {isActive && (
                  <>
                    <View
                      style={{
                        position: 'absolute',
                        top: 0,
                        left: 0,
                        right: 0,
                        bottom: 0,
                        backgroundColor: tab.gradient[0],
                      }}
                    />
                    <ShimmerGradient colors={tab.gradient} />
                  </>
                )}
                
                <View style={styles.filterTabContent}>
                  <Text style={styles.filterTabIcon}>{tab.icon}</Text>
                  <Text
                    style={[
                      styles.filterTabText,
                      {
                        color: isActive ? '#FFFFFF' : AppColors.textSecondary,
                      },
                    ]}
                  >
                    {tab.label}
                  </Text>
                </View>
              </TouchableOpacity>
            </Animated.View>
          );
        })}
      </View>
    </View>
  );
```

## üé® STEP 4: Component Architecture

### 4.1 Analytics Card Components
**File**: `components/analytics/MetricCard.tsx`

```typescript
import React from 'react';
import { View, Text, StyleSheet } from 'react-native';
import { AppColors } from '@/constants/Colors';

interface MetricCardProps {
  title: string;
  value: string | number;
  subtitle?: string;
  icon?: string;
  trend?: 'up' | 'down' | 'neutral';
  trendValue?: string;
}

export default function MetricCard({ 
  title, 
  value, 
  subtitle, 
  icon, 
  trend, 
  trendValue 
}: MetricCardProps) {
  const getTrendColor = () => {
    switch (trend) {
      case 'up': return AppColors.success;
      case 'down': return AppColors.error;
      default: return AppColors.textSecondary;
    }
  };

  return (
    <View style={styles.card}>
      <View style={styles.header}>
        <Text style={styles.title}>{title}</Text>
        {icon && <Text style={styles.icon}>{icon}</Text>}
      </View>
      <Text style={styles.value}>{value}</Text>
      {subtitle && <Text style={styles.subtitle}>{subtitle}</Text>}
      {trend && trendValue && (
        <View style={styles.trendContainer}>
          <Text style={[styles.trend, { color: getTrendColor() }]}>
            {trend === 'up' ? '‚ÜóÔ∏è' : trend === 'down' ? '‚ÜòÔ∏è' : '‚Üí'} {trendValue}
          </Text>
        </View>
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  card: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 16,
    padding: 20,
    ...AppColors.shadows.card,
    flex: 1,
    marginHorizontal: 8,
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 12,
  },
  title: {
    fontSize: 14,
    fontWeight: '500',
    color: AppColors.textSecondary,
  },
  icon: {
    fontSize: 16,
  },
  value: {
    fontSize: 32,
    fontWeight: '800',
    color: AppColors.textPrimary,
    lineHeight: 36,
  },
  subtitle: {
    fontSize: 12,
    color: AppColors.textSecondary,
    marginTop: 4,
  },
  trendContainer: {
    marginTop: 8,
  },
  trend: {
    fontSize: 12,
    fontWeight: '600',
  },
});
```

### 4.2 AI Insights Card Component  
**File**: `components/analytics/AIInsightCard.tsx`

```typescript
import React, { useState } from 'react';
import { View, Text, TouchableOpacity, StyleSheet } from 'react-native';
import { AppColors } from '@/constants/Colors';
import type { AIInsight } from '~/types/analytics';

interface AIInsightCardProps {
  insight: AIInsight;
  onAction?: (action: string) => void;
  onDismiss?: () => void;
}

export default function AIInsightCard({ 
  insight, 
  onAction, 
  onDismiss 
}: AIInsightCardProps) {
  const [showSources, setShowSources] = useState(false);

  const getConfidenceColor = (confidence: number) => {
    if (confidence >= 90) return AppColors.success;
    if (confidence >= 70) return AppColors.warning;
    return AppColors.error;
  };

  const getImpactColor = (impact?: string) => {
    switch (impact) {
      case 'high': return AppColors.error;
      case 'medium': return AppColors.warning;
      case 'low': return AppColors.success;
      default: return AppColors.textSecondary;
    }
  };

  return (
    <View style={styles.card}>
      <View style={styles.header}>
        <Text style={styles.title}>{insight.title}</Text>
        <View style={styles.badges}>
          {insight.impact && (
            <View style={[styles.badge, { backgroundColor: getImpactColor(insight.impact) }]}>
              <Text style={styles.badgeText}>{insight.impact.toUpperCase()}</Text>
            </View>
          )}
          <View style={styles.confidenceBadge}>
            <Text style={[styles.confidenceText, { color: getConfidenceColor(insight.confidence) }]}>
              {insight.confidence}%
            </Text>
          </View>
        </View>
      </View>
      
      <Text style={styles.message}>{insight.message}</Text>
      
      {insight.suggestions && insight.suggestions.length > 0 && (
        <View style={styles.suggestions}>
          {insight.suggestions.map((suggestion, index) => (
            <Text key={index} style={styles.suggestion}>‚Ä¢ {suggestion}</Text>
          ))}
        </View>
      )}

      {/* Sources (Shape of AI Citations Pattern) */}
      <TouchableOpacity 
        style={styles.sourcesButton}
        onPress={() => setShowSources(!showSources)}
      >
        <Text style={styles.sourcesText}>
          {showSources ? 'Hide' : 'View'} Sources ({insight.sources.length})
        </Text>
      </TouchableOpacity>
      
      {showSources && (
        <View style={styles.sources}>
          {insight.sources.map((source, index) => (
            <Text key={index} style={styles.source}>‚Ä¢ {source}</Text>
          ))}
        </View>
      )}

      {/* Actions */}
      <View style={styles.actions}>
        {insight.action && (
          <TouchableOpacity 
            style={styles.actionButton}
            onPress={() => onAction?.(insight.action!)}
          >
            <Text style={styles.actionButtonText}>{insight.action}</Text>
          </TouchableOpacity>
        )}
        <TouchableOpacity 
          style={styles.dismissButton}
          onPress={onDismiss}
        >
          <Text style={styles.dismissButtonText}>Not Now</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
}

const styles = StyleSheet.create({
  card: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 16,
    padding: 20,
    marginBottom: 16,
    ...AppColors.shadows.card,
    borderLeftWidth: 4,
    borderLeftColor: AppColors.aiGradientStart,
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'flex-start',
    marginBottom: 12,
  },
  title: {
    fontSize: 16,
    fontWeight: '600',
    color: AppColors.textPrimary,
    flex: 1,
    marginRight: 12,
  },
  badges: {
    flexDirection: 'row',
    gap: 8,
  },
  badge: {
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 8,
  },
  badgeText: {
    fontSize: 10,
    fontWeight: '700',
    color: '#FFFFFF',
  },
  confidenceBadge: {
    paddingHorizontal: 8,
    paddingVertical: 4,
    backgroundColor: AppColors.background,
    borderRadius: 8,
  },
  confidenceText: {
    fontSize: 10,
    fontWeight: '700',
  },
  message: {
    fontSize: 14,
    color: AppColors.textPrimary,
    lineHeight: 20,
    marginBottom: 12,
  },
  suggestions: {
    marginBottom: 12,
  },
  suggestion: {
    fontSize: 12,
    color: AppColors.textSecondary,
    lineHeight: 16,
    marginBottom: 4,
  },
  sourcesButton: {
    alignSelf: 'flex-start',
    marginBottom: 12,
  },
  sourcesText: {
    fontSize: 12,
    color: AppColors.aiGradientStart,
    fontWeight: '600',
  },
  sources: {
    backgroundColor: AppColors.background,
    borderRadius: 8,
    padding: 12,
    marginBottom: 12,
  },
  source: {
    fontSize: 11,
    color: AppColors.textSecondary,
    lineHeight: 14,
    marginBottom: 2,
  },
  actions: {
    flexDirection: 'row',
    gap: 12,
  },
  actionButton: {
    backgroundColor: AppColors.aiGradientStart,
    paddingVertical: 10,
    paddingHorizontal: 16,
    borderRadius: 8,
    flex: 1,
  },
  actionButtonText: {
    color: '#FFFFFF',
    fontSize: 14,
    fontWeight: '600',
    textAlign: 'center',
  },
  dismissButton: {
    backgroundColor: AppColors.background,
    paddingVertical: 10,
    paddingHorizontal: 16,
    borderRadius: 8,
    flex: 1,
  },
  dismissButtonText: {
    color: AppColors.textSecondary,
    fontSize: 14,
    fontWeight: '600',
    textAlign: 'center',
  },
});
```

## üèóÔ∏è Implementation Steps
Step 1: File Structure Changes
1.1 File Rename & Routing Update
Apply to analytics.md...
>
1.2 Import Updates
Apply to analytics.md...
;
Step 2: Analytics Screen Structure
2.1 Tab Configuration (Following Profile Pattern)
Apply to analytics.md...
;
2.2 Header Section (Following Approvals Pattern)
Apply to analytics.md...
>
Step 3: Component Architecture
3.1 Data Fetching Hook
Apply to analytics.md...
}
3.2 Analytics Components
Apply to analytics.md...
}
Step 4: Tab Content Implementation
4.1 Dashboard Tab (Performance Dashboard)
Apply to analytics.md...
;
4.2 AI Insights Tab (AI Insights Engine)
Apply to analytics.md...
;
4.3 Trends Tab (Trend Analysis)
Apply to analytics.md...
;
4.4 Reports Tab (Export & Comparison)
Apply to analytics.md...
;
Step 5: Shape of AI Integration
5.1 AI Transparency Patterns
Apply to analytics.md...
;
5.2 Trust Indicators
Apply to analytics.md...
;
Step 6: Animation & Styling (Identical to Existing Patterns)
6.1 Tab Animation System (Copy from Profile.tsx)
Apply to analytics.md...
AnalyticsTabs
6.2 Styling System (Reuse AppColors & Patterns)
Apply to analytics.md...
;
Step 7: Data Architecture
7.1 Mock Analytics Data
Apply to analytics.md...
;
Step 8: Migration Strategy
8.1 File Migration Steps
Backup Current: Copy history.tsx to history.backup.tsx
Create Analytics: Create new analytics.tsx based on profile.tsx pattern
Update Routing: Modify _layout.tsx tab configuration
Test Navigation: Ensure tab switching works correctly
Update Links: Find any internal links to /history and update to /analytics
8.2 Feature Flag Approach
Apply to analytics.md...
;
Step 9: Performance Considerations
9.1 Chart Optimization
Apply to analytics.md...
;
9.2 Animation Performance
Apply to analytics.md...
components
Step 10: Testing Strategy
10.1 Functionality Tests
‚úÖ Tab navigation works correctly
‚úÖ Data loading and error states
‚úÖ Authentication flow (login redirect)
‚úÖ Charts render correctly with mock data
‚úÖ AI insights display properly
‚úÖ Export functionality works
10.2 Visual Regression Tests
‚úÖ Matches design system colors and spacing
‚úÖ Animations are smooth (60fps)
‚úÖ Charts are readable and accessible
‚úÖ Responsive on different screen sizes
üöÄ Success Metrics
User Engagement
Time Spent: Users spend more time in analytics vs old history screen
Feature Discovery: Users interact with AI insights and suggestions
Action Rate: Users apply AI recommendations
Return Frequency: Regular check-ins for progress tracking
Technical Performance
Load Time: Screen loads in <2 seconds
Animation Performance: Consistent 60fps animations
Memory Usage: No memory leaks from charts or animations
Bundle Size: Minimal impact on app size
```

## üì± STEP 5: Tab Content Implementation

### 5.1 Dashboard Tab - Performance Dashboard
```typescript
  const DashboardContent = () => (
    <ScrollView style={styles.tabContent} showsVerticalScrollIndicator={false}>
      {/* Today's Metrics Grid - Following screens.mdc requirements */}
      <View style={styles.metricsContainer}>
        <View style={styles.metricsRow}>
          <MetricCard
            title="Tasks Done"
            value={analytics?.todayMetrics.tasksCompleted ?? 0}
            icon="‚úÖ"
            trend="up"
            trendValue="+2 from yesterday"
          />
          <MetricCard
            title="Focus Hours"
            value={analytics?.todayMetrics.hoursFocused?.toFixed(1) ?? '0.0'}
            icon="‚è±Ô∏è"
            trend="up"
            trendValue="+0.8h"
          />
        </View>
        <View style={styles.metricsRow}>
          <MetricCard
            title="XP Earned"
            value={analytics?.todayMetrics.xpEarned ?? 0}
            icon="üåü"
            trend="up"
            trendValue="+15%"
          />
          <MetricCard
            title="Efficiency"
            value={`${analytics?.todayMetrics.efficiencyScore ?? 0}%`}
            icon="üéØ"
            subtitle="AI-calculated score"
            trend="up"
            trendValue="+5%"
          />
        </View>
      </View>

      {/* Energy Curve Chart Card */}
      <View style={styles.chartCard}>
        <Text style={styles.cardTitle}>üìà Energy Curve</Text>
        <Text style={styles.cardSubtitle}>Real-time productivity levels throughout the day</Text>
        
        {/* Placeholder for chart - will be implemented with react-native-chart-kit */}
        <View style={styles.chartPlaceholder}>
          <Text style={styles.chartPlaceholderText}>
            Energy Chart Component
          </Text>
          <Text style={styles.chartDescription}>
            Peak performance window: 9:00 AM - 11:30 AM
          </Text>
        </View>
      </View>

      {/* Focus Streaks Card */}
      <View style={styles.streakCard}>
        <Text style={styles.cardTitle}>üî• Focus Streaks</Text>
        <View style={styles.streakContainer}>
          <View style={styles.streakItem}>
            <Text style={styles.streakLabel}>Current</Text>
            <Text style={styles.streakValue}>{analytics?.todayMetrics.currentStreak ?? 0} min</Text>
          </View>
          <View style={styles.streakDivider} />
          <View style={styles.streakItem}>
            <Text style={styles.streakLabel}>Best Today</Text>
            <Text style={styles.streakValue}>{analytics?.todayMetrics.bestStreak ?? 0} min</Text>
          </View>
        </View>
        <View style={styles.streakProgress}>
          <View style={styles.progressBar}>
            <View 
              style={[
                styles.progressFill, 
                { width: `${((analytics?.todayMetrics.currentStreak ?? 0) / 180) * 100}%` }
              ]} 
            />
          </View>
          <Text style={styles.progressText}>Goal: 3 hours focused work</Text>
        </View>
      </View>
    </ScrollView>
  );
```

### 5.2 AI Insights Tab - AI Insights Engine
```typescript
  const InsightsContent = () => (
    <ScrollView style={styles.tabContent} showsVerticalScrollIndicator={false}>
      {analytics?.aiInsights.map((insight) => (
        <AIInsightCard
          key={insight.id}
          insight={insight}
          onAction={(action) => {
            console.log('Action:', action);
            // Handle AI suggestion actions
          }}
          onDismiss={() => {
            console.log('Dismissed insight:', insight.id);
            // Handle dismissing insights
          }}
        />
      ))}
      
      {/* Empty state for insights */}
      {(!analytics?.aiInsights || analytics.aiInsights.length === 0) && (
        <View style={styles.emptyInsights}>
          <Text style={styles.emptyInsightsIcon}>üß†</Text>
          <Text style={styles.emptyInsightsTitle}>AI is learning your patterns</Text>
          <Text style={styles.emptyInsightsText}>
            Continue using the app to get personalized productivity insights
          </Text>
        </View>
      )}
    </ScrollView>
  );
```

### 5.3 Trends Tab - Trend Analysis
```typescript
  const TrendsContent = () => (
    <ScrollView style={styles.tabContent} showsVerticalScrollIndicator={false}>
      {/* Weekly Patterns Heatmap */}
      <View style={styles.chartCard}>
        <Text style={styles.cardTitle}>üìÖ Weekly Productivity Heatmap</Text>
        <Text style={styles.cardSubtitle}>Your productive vs. challenging times</Text>
        
        {/* Placeholder for heatmap chart */}
        <View style={styles.heatmapPlaceholder}>
          <Text style={styles.chartPlaceholderText}>Weekly Heatmap Chart</Text>
          {analytics?.weeklyPatterns.map((pattern, index) => (
            <View key={index} style={styles.patternRow}>
              <Text style={styles.dayLabel}>{pattern.day}</Text>
              <View style={styles.patternBars}>
                <View style={[styles.patternBar, { width: `${pattern.productivity}%`, backgroundColor: AppColors.success }]} />
              </View>
              <Text style={styles.patternValue}>{pattern.productivity}%</Text>
            </View>
          ))}
        </View>
      </View>

      {/* Task Completion Velocity */}
      <View style={styles.chartCard}>
        <Text style={styles.cardTitle}>‚ö° Task Completion Velocity</Text>
        <Text style={styles.cardSubtitle}>How quickly you finish different types of work</Text>
        
        <View style={styles.velocityMetrics}>
          <View style={styles.velocityItem}>
            <Text style={styles.velocityLabel}>Average</Text>
            <Text style={styles.velocityValue}>6.2 tasks/day</Text>
          </View>
          <View style={styles.velocityItem}>
            <Text style={styles.velocityLabel}>Trend</Text>
            <Text style={[styles.velocityValue, { color: AppColors.success }]}>‚ÜóÔ∏è +15%</Text>
          </View>
        </View>
      </View>

      {/* Time Saved Meter */}
      <View style={styles.impactCard}>
        <Text style={styles.cardTitle}>üíé AI Impact This Month</Text>
        <View style={styles.timeSavedContainer}>
          <View style={styles.circularProgress}>
            <Text style={styles.timeSavedValue}>12.5h</Text>
            <Text style={styles.timeSavedLabel}>saved</Text>
          </View>
          <View style={styles.timeSavedDetails}>
            <Text style={styles.timeSavedDescription}>
              Through automated scheduling and smart suggestions
            </Text>
            <View style={styles.savingsBreakdown}>
              <Text style={styles.savingsItem}>‚Ä¢ 6.2h from smart scheduling</Text>
              <Text style={styles.savingsItem}>‚Ä¢ 4.1h from focus optimization</Text>
              <Text style={styles.savingsItem}>‚Ä¢ 2.2h from distraction reduction</Text>
            </View>
          </View>
        </View>
      </View>
    </ScrollView>
  );
```

### 5.4 Reports Tab - Export & Comparison
```typescript
  const ReportsContent = () => (
    <ScrollView style={styles.tabContent} showsVerticalScrollIndicator={false}>
      {/* Export Options */}
      <View style={styles.exportCard}>
        <Text style={styles.cardTitle}>üì§ Export Reports</Text>
        <Text style={styles.cardSubtitle}>Share your productivity data</Text>
        
        <TouchableOpacity style={styles.exportButton}>
          <Text style={styles.exportButtonIcon}>üìÑ</Text>
          <View style={styles.exportButtonContent}>
            <Text style={styles.exportButtonTitle}>Weekly Summary PDF</Text>
            <Text style={styles.exportButtonDescription}>Comprehensive weekly report</Text>
          </View>
        </TouchableOpacity>
        
        <TouchableOpacity style={styles.exportButton}>
          <Text style={styles.exportButtonIcon}>üìä</Text>
          <View style={styles.exportButtonContent}>
            <Text style={styles.exportButtonTitle}>Monthly Analytics CSV</Text>
            <Text style={styles.exportButtonDescription}>Raw data for analysis</Text>
          </View>
        </TouchableOpacity>
      </View>

      {/* Analytics Milestones Progress */}
      <View style={styles.milestonesCard}>
        <Text style={styles.cardTitle}>üèÜ Analytics Milestones</Text>
        <Text style={styles.cardSubtitle}>Track your analytics achievements</Text>
        
        <View style={styles.milestone}>
          <View style={styles.milestoneHeader}>
            <Text style={styles.milestoneTitle}>Pattern Seeker</Text>
            <Text style={styles.milestoneXP}>+75 XP</Text>
          </View>
          <Text style={styles.milestoneDescription}>Review analytics for 7 consecutive days</Text>
          <View style={styles.milestoneProgress}>
            <View style={styles.progressBar}>
              <View style={[styles.progressFill, { width: '71%' }]} />
            </View>
            <Text style={styles.progressText}>5/7 days</Text>
          </View>
        </View>

        <View style={styles.milestone}>
          <View style={styles.milestoneHeader}>
            <Text style={styles.milestoneTitle}>Data Detective</Text>
            <Text style={styles.milestoneXP}>+200 XP</Text>
          </View>
          <Text style={styles.milestoneDescription}>Discover and act on 3 personal productivity patterns</Text>
          <View style={styles.milestoneProgress}>
            <View style={styles.progressBar}>
              <View style={[styles.progressFill, { width: '33%' }]} />
            </View>
            <Text style={styles.progressText}>1/3 patterns</Text>
          </View>
        </View>

        <View style={styles.milestone}>
          <View style={styles.milestoneHeader}>
            <Text style={styles.milestoneTitle}>Efficiency Engineer</Text>
            <Text style={styles.milestoneXP}>+300 XP</Text>
          </View>
          <Text style={styles.milestoneDescription}>Improve weekly productivity score by 25%</Text>
          <View style={styles.milestoneProgress}>
            <View style={styles.progressBar}>
              <View style={[styles.progressFill, { width: '0%' }]} />
            </View>
            <Text style={styles.progressText}>0% improvement</Text>
          </View>
        </View>
      </View>
    </ScrollView>
  );
```

## üé® STEP 6: Main Screen Structure & Authentication

### 6.1 Complete Screen Implementation
```typescript
  // Authentication check (identical to profile.tsx pattern)
  if (!user) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.emptyContainer}>
          <TrendingUp size={64} color="#8E8E93" />
          <Text style={styles.title}>Analytics</Text>
          <Text style={styles.subtitle}>Please log in to view your analytics</Text>
          
          <Link href="/(auth)/login" asChild>
            <TouchableOpacity style={styles.loginButton}>
              <Text style={styles.loginButtonText}>Login</Text>
            </TouchableOpacity>
          </Link>
        </View>
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      {/* Header Section - IDENTICAL to profile.tsx */}
      <View style={styles.header}>
        <View style={styles.headerTop}>
          <View style={styles.titleContainer}>
            <Text style={styles.title}>Analytics</Text>
          </View>
        </View>
        <Text style={styles.subtitle}>
          Your productivity scientist
        </Text>
      </View>

      {/* Analytics Tabs - IDENTICAL pattern to ProfileTabs */}
      <AnalyticsTabs />

      {/* Tab Content */}
      <View style={styles.listContainer}>
        {renderTabContent()}
      </View>
    </SafeAreaView>
  );

  // Tab content renderer
  const renderTabContent = () => {
    switch (selectedTab) {
      case 'dashboard':
        return <DashboardContent />;
      case 'insights':
        return <InsightsContent />;
      case 'trends':
        return <TrendsContent />;
      case 'reports':
        return <ReportsContent />;
      default:
        return null;
    }
  };
};
```

## üé® STEP 7: Styling System (Exact Profile.tsx Pattern)

### 7.1 Complete StyleSheet
```typescript
const styles = StyleSheet.create({
  // IDENTICAL base styles from profile.tsx
  container: {
    flex: 1,
    backgroundColor: AppColors.background,
  },
  header: {
    backgroundColor: AppColors.cardBackground,
    padding: 24,
    paddingTop: 20,
    borderBottomWidth: 1,
    borderBottomColor: AppColors.border,
  },
  headerTop: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 12,
    minHeight: 40,
  },
  titleContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 12,
    flex: 1,
  },
  title: {
    fontSize: 28,
    fontWeight: '700',
    color: AppColors.textPrimary,
  },
  subtitle: {
    fontSize: 16,
    color: AppColors.textSecondary,
    fontWeight: '400',
    marginTop: 4,
  },

  // IDENTICAL tab styles from profile.tsx
  filterTabsContainer: {
    marginVertical: 12,
    paddingHorizontal: 16,
  },
  filterTabsContent: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    paddingHorizontal: 2,
  },
  filterTab: {
    flex: 1,
    marginHorizontal: 3,
    paddingVertical: 12,
    paddingHorizontal: 8,
    borderRadius: 14,
    alignItems: 'center',
    justifyContent: 'center',
    backgroundColor: AppColors.cardBackground,
    borderWidth: 2,
    borderColor: AppColors.borderLight,
    ...AppColors.shadows.card,
    minHeight: 50,
  },
  filterTabActive: {
    borderWidth: 0,
    ...AppColors.shadows.elevated,
  },
  filterTabContent: {
    alignItems: 'center',
    gap: 4,
  },
  filterTabIcon: {
    fontSize: 16,
  },
  filterTabText: {
    fontSize: 13,
    fontWeight: '600',
  },
  listContainer: {
    flex: 1,
  },
  tabContent: {
    flex: 1,
    paddingHorizontal: 20,
  },

  // Analytics-specific styles
  metricsContainer: {
    marginBottom: 20,
  },
  metricsRow: {
    flexDirection: 'row',
    marginBottom: 16,
    marginHorizontal: -8,
  },
  chartCard: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 16,
    padding: 20,
    marginBottom: 16,
    ...AppColors.shadows.card,
  },
  cardTitle: {
    fontSize: 18,
    fontWeight: '600',
    color: AppColors.textPrimary,
    marginBottom: 4,
  },
  cardSubtitle: {
    fontSize: 14,
    color: AppColors.textSecondary,
    marginBottom: 16,
  },
  chartPlaceholder: {
    height: 200,
    backgroundColor: AppColors.background,
    borderRadius: 12,
    justifyContent: 'center',
    alignItems: 'center',
    marginBottom: 12,
  },
  chartPlaceholderText: {
    fontSize: 16,
    color: AppColors.textSecondary,
    fontWeight: '500',
  },
  chartDescription: {
    fontSize: 12,
    color: AppColors.textSecondary,
    marginTop: 8,
    textAlign: 'center',
  },
  streakCard: {
    backgroundColor: AppColors.cardBackground,
    borderRadius: 16,
    padding: 20,
    marginBottom: 16,
    ...AppColors.shadows.card,
    borderLeftWidth: 4,
    borderLeftColor: AppColors.success,
  },
  streakContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 16,
  },
  streakItem: {
    flex: 1,
    alignItems: 'center',
  },
  streakDivider: {
    width: 1,
    height: 40,
    backgroundColor: AppColors.borderLight,
    marginHorizontal: 20,
  },
  streakLabel: {
    fontSize: 12,
    color: AppColors.textSecondary,
    fontWeight: '500',
    marginBottom: 4,
  },
  streakValue: {
    fontSize: 24,
    fontWeight: '700',
    color: AppColors.textPrimary,
  },
  streakProgress: {
    marginTop: 8,
  },
  progressBar: {
    height: 6,
    backgroundColor: AppColors.borderLight,
    borderRadius: 3,
    overflow: 'hidden',
    marginBottom: 8,
  },
  progressFill: {
    height: '100%',
    backgroundColor: AppColors.success,
    borderRadius: 3,
  },
  progressText: {
    fontSize: 12,
    color: AppColors.textSecondary,
    textAlign: 'center',
  },

  // Empty states
  emptyContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 24,
  },
  loginButton: {
    marginTop: 16,
    backgroundColor: AppColors.aiGradientStart,
    paddingVertical: 12,
    paddingHorizontal: 24,
    borderRadius: 8,
  },
  loginButtonText: {
    color: '#FFFFFF',
    fontSize: 16,
    fontWeight: '600',
  },
  emptyInsights: {
    alignItems: 'center',
    padding: 40,
  },
  emptyInsightsIcon: {
    fontSize: 48,
    marginBottom: 16,
  },
  emptyInsightsTitle: {
    fontSize: 18,
    fontWeight: '600',
    color: AppColors.textPrimary,
    marginBottom: 8,
  },
  emptyInsightsText: {
    fontSize: 14,
    color: AppColors.textSecondary,
    textAlign: 'center',
    lineHeight: 20,
  },

  // Additional analytics styles...
  // [Continue with remaining style definitions...]
});
```

## üöÄ STEP 8: Migration & Testing Strategy

### 8.1 Migration Checklist
- [ ] **Backup Current File**: `cp app/(tabs)/history.tsx app/(tabs)/history.backup.tsx`
- [ ] **Update Tab Layout**: Modify `app/(tabs)/_layout.tsx` imports and screen name
- [ ] **Create Types File**: Add `src/types/analytics.ts`
- [ ] **Create Hook**: Add `hooks/useFetchAnalytics.ts`
- [ ] **Create Components**: Add analytics component files
- [ ] **Update Main Screen**: Transform `history.tsx` to `analytics.tsx`
- [ ] **Test Navigation**: Ensure tab switching works
- [ ] **Test Authentication**: Verify login redirect works
- [ ] **Test Data Loading**: Verify mock data displays correctly

### 8.2 Performance Optimizations
```typescript
// Lazy load chart components when needed
const EnergyChart = React.lazy(() => import('@/components/analytics/EnergyChart'));
const ProductivityHeatmap = React.lazy(() => import('@/components/analytics/ProductivityHeatmap'));

// Memoize processed data
const processedMetrics = useMemo(() => {
  return analytics ? processAnalyticsData(analytics) : null;
}, [analytics]);

// Optimize re-renders
const MemoizedMetricCard = React.memo(MetricCard);
const MemoizedAIInsightCard = React.memo(AIInsightCard);
```

### 8.3 Success Metrics
- **Load Time**: Analytics screen loads in <2 seconds
- **Animation Performance**: 60fps tab animations
- **Memory Usage**: No memory leaks from chart components
- **User Engagement**: Users spend more time than old history screen
- **Feature Discovery**: Users interact with AI insights
- **Data Accuracy**: Mock data displays correctly before real API

## üìä Implementation Timeline

### Week 1: Foundation
- [x] File structure and routing updates
- [x] Type system and data hooks
- [x] Basic screen layout with tabs
- [x] Authentication integration

### Week 2: Core Components
- [ ] MetricCard and AIInsightCard components
- [ ] Tab content implementations
- [ ] Styling system completion
- [ ] Animation integration

### Week 3: Advanced Features
- [ ] Chart placeholders and mock data
- [ ] Export functionality
- [ ] Milestone tracking
- [ ] Performance optimization

### Week 4: Testing & Polish
- [ ] Cross-device testing
- [ ] Animation performance tuning
- [ ] Accessibility improvements
- [ ] Final integration testing

This implementation plan provides a complete, codebase-accurate roadmap for transforming the history screen into a comprehensive analytics dashboard that follows all existing patterns and implements the full feature set from the screens.mdc requirements.